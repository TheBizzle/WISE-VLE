<html>
<head>
<script type="text/javascript" src="js/sound/soundmanager/script/soundmanager2.js"></script>
<script type="text/javascript" src="js/sound/AudioManager.js"></script>

<!-- Dependency --> 
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/yahoo/yahoo-min.js" ></script>

<!-- Event source file -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/event/event-min.js" ></script>

<!-- Sam Skin CSS -->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.7.0/build/container/assets/skins/sam/container.css">

<!-- Dependencies -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"></script>

<!-- OPTIONAL: Animation (only required if using ContainerEffect) -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/animation/animation-min.js"></script>

<!-- OPTIONAL: Drag & Drop (only required if enabling Drag & Drop) -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/dragdrop/dragdrop-min.js"></script>

<!-- Source file -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/container/container-min.js"></script>

<!-- Connection manager -->
<script src="http://yui.yahooapis.com/2.7.0/build/connection/connection-min.js"></script>


<script src="http://yui.yahooapis.com/3.0.0pr2/build/yui/yui-min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/common/helperfunctions.js"></script>
<script type="text/javascript" src="js/VLE.js"></script>
<script type="text/javascript" src="js/contentpanel/ContentPanel.js"></script>
<script type="text/javascript" src="js/navigation/NavigationLogic.js"></script>
<script type="text/javascript" src="js/navigation/DFS.js"></script>
<script type="text/javascript" src="js/navigation/NavigationPanel.js"></script>
<script type="text/javascript" src="js/common/loadxmldoc.js"></script>
<script type="text/javascript" src="js/node/Node.js"></script>
<script type="text/javascript" src="js/node/HtmlNode.js"></script>
<script type="text/javascript" src="js/node/CustomNode.js"></script>
<script type="text/javascript" src="js/node/MatchSequenceNode.js"></script>
<script type="text/javascript" src="js/node/FillinNode.js"></script>
<script type="text/javascript" src="js/node/NoteNode.js"></script>
<script type="text/javascript" src="js/node/JournalNode.js"></script>
<script type="text/javascript" src="js/node/OutsideUrlNode.js"></script>
<script type="text/javascript" src="js/node/BlueJNode.js"></script>
<script type="text/javascript" src="js/node/MultipleChoiceNode.js"></script>
<script type="text/javascript" src="js/project/Project.js"></script>
<script type="text/javascript" src="js/project/pas/PasOtmlProject.js"></script>
<script type="text/javascript" src="js/io/ConnectionManager.js"></script>

<script type="text/javascript" src="js/common/niftycube.js"></script>
<script type="text/javascript" src="js/common/sdmenu.js"></script>
<script type="text/javascript" src="js/common/dropdown.js"></script>

<link rel="stylesheet" type="text/css" href="css/niftyCube.css" />
<link rel="stylesheet" type="text/css" href="css/navigation.css" />
<link rel="stylesheet" type="text/css" href="css/sdmenu.css" />



<script type='text/javascript'>
var project;

//a string that temporarily contains the node id we want to author
var nodeIdToAuthor;
 

window.onload=function(){
	//loads the project into the authoring tool
	loadProject();
}

/*
 * This is called onload of the 'authoringFrame' iframe
 */
function authoringFrameOnLoad() {
	/*
	 * if project is null, it means this is the first time this page has been
	 * loaded and also the first time the authoringFrame iframe has been
	 * loaded so the project has not been loaded yet. This is ok, we only
	 * need this function to set the node after the user has clicked on a
	 * step.
	 */
	if(project != null) {
		//pass the node that we're going to author to the authoringFrame
		window.frames["authoringFrame"].node = project.rootNode.getNodeById(nodeIdToAuthor);

		/*
		 * call load on the html page that is in the authoringFrame
		 * so that the page in the authoringFrame can do what it needs to
		 * do with the node we just gave it above
		 */
		window.frames["authoringFrame"].loadAuthoring();
	}
}

/*
 * Remembers the nodeId we currently want to author in a global variable so we
 * can call project.rootNode.getNodeById(nodeIdToAuthor) later to retrieve
 * the node. nodeId is a string.
 */
function setNodeToAuthor(nodeId) {
	/*
	 * sets the node to be authored so later in authoringFrameLoaded()
	 * we know which node to pass to the authoringFrame
	 */
	nodeIdToAuthor = nodeId;
}

</script>
</head>

<body>
<p>Authoring Tool</p>

<table width='100%' height='100%'>
	<tr>
		<td width='10%'>
			<table id='authoringTable' valign='top'>
		
			</table>
		</td>
		<td width='90%'>
			<table>
				<iframe id='authoringFrame' name='authoringFrame' style='width:100%;height:100%' onload='authoringFrameOnLoad()'></iframe>
			</table>
		</td>
	</tr>
</table>

	
<script type="text/javascript">
	
function loadProject() {
	var callback =
	{
	  success: function(o) { 
		  var xmlDocObj = new LoadXMLDocObj();
		  xmlDocObj.xmlDoc = o.responseXML;
		  //alert(o.responseXML);
		  var xmlDocToParse = o.responseXML;
		  if (o.responseXML.getElementsByTagName("OTPasActivity").length == 0) {
			  var windowsXMLDoc = new ActiveXObject("Microsoft.XMLDOM");
			  windowsXMLDoc.async = "false";
			  windowsXMLDoc.loadXML(o.responseText);
			  xmlDocToParse = windowsXMLDoc;
		  }		  
		  project = new PasOtmlProject(xmlDocObj);
		  project.xmlDoc = o.responseXML;
		  project.generateNode(xmlDocToParse);

		  //authoringTool.setProject(project);

		  displayNode(project.rootNode);
		  
			//authoringTool.renderNode('0:0:0');
		},
	  failure: function(o) { alert('failure');},
	  argument: ["a", "b", "c"]
	}
	var transaction = YAHOO.util.Connect.asyncRequest('GET', "POC2v9.otml", callback, null);
	  //var xmlDocObj = new LoadXMLDocObj();
	  //var project = new PasOtmlProject(xmlDocObj);
	  //xmlDocObj.load("POC2v9.otml");
	  //xmlDocObj.load("all_step_types.otml");
	  //vle.audioManager = new AudioManager(true);	  
}

/*
 * Displays all the children nodes in the left hand column table
 */
function displayNode(node) {
	var children = node.children;

	if(children == null || children.length == 0) {
		//this node is a leaf node
		document.getElementById('authoringTable').innerHTML += createStepRow(node);
	} else {
		//recursively traverse this node's children
		for(var x=0; x<children.length; x++) {
			displayNode(children[x]);
		}
	}
	
}

/*
 * Creates a tr that contains a td and a link to an authoring page for the
 * node depending on the node type.
 */
function createStepRow(node) {
	var rowHTML = "";
	var authoringPage = "";
	
	if(node.type == 'HtmlNode') {
		authoringPage = "js/node/html/html_authoring.html";
	} else if(node.type == 'OTQuiz') {
		authoringPage = "js/node/multiplechoice/multiplechoice_authoring.html";
	} else {
		//authoring of this step type is not available yet
	}

	rowHTML = "<tr><td><a href='" + authoringPage + "' target='authoringFrame' onclick='setNodeToAuthor(\"" + node.id + "\")'>" + node.title + " (" + node.type + ")</a></td></tr>";
	return rowHTML;
}

function exportProject() {
	
}

</script>

</body>

</html>