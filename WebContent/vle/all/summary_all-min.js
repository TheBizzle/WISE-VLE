function createAttribute(d,c,a,e){var b=d.createAttribute(a);b.nodeValue=e;c.setAttributeNode(b)}function createElement(d,c,a){var e=d.createElement(c);if(a!=null){for(var b in a){createAttribute(d,e,b,a[b])}}return e}function createBreak(){return createElement(document,"br",null)}function createSpace(){return document.createTextNode(" ")}function encodeString(a){return encodeURIComponent(a)}function getElementsByAttribute(c,f,a){notificationManager.notify("attributeName:"+c+", attributeValue:"+f,4);var e=null;if(a!=null){notificationManager.notify("frameName:"+a,4);e=yui.get(window.frames.ifrm.frames[a].document.body)}else{e=yui.get(window.frames.ifrm.document.body)}if(f!=null){var g=e.query("["+c+"="+f+"]");notificationManager.notify("audioNode:"+g,4);return g}else{var b=e.queryAll("["+c+"]");if(b!=null){notificationManager.notify("audioNodes.length:"+b.size(),4);for(var d=0;d<b.size();d++){notificationManager.notify("audioNode textContent:"+b.item(d).get("textContent"),4)}}return b}}function checkAccessibility(a){var c={success:function(d){return true},failure:function(d){return false}};var b=YAHOO.util.Connect.asyncRequest("HEAD",a,c,null)}function normalizeHTML(a){return a.replace(/\s+/g,"")}function injectVleUrl(b){var c=window.location.toString();var a=c.substring(0,c.indexOf("/vle/"))+"/vle/";b=b.replace(/(src='|src="|href='|href=")(?!http|\/)/gi,"$1"+a);return b}if(!Array.contains){Array.prototype.contains=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return true}}return false}}if(!Array.indexOf){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1}}if(!Array.map){Array.prototype.map=function(a){var c=[];for(var b=0;b<this.length;b++){c.push(a(this[i]))}return c}}if(!Array.compare){Array.prototype.compare=function(b){if(this.length!=b.length){return false}for(var a=0;a<b.length;a++){if(this[a].compare){if(!this[a].compare(b[a])){return false}}if(this[a]!==b[a]){return false}}return true}}function hideElement(a){document.getElementById(a).style.display="none"}function showElement(a){document.getElementById(a).style.display="block"}function findPos(a){var b=curtop=0;if(a.offsetParent){do{b+=a.offsetLeft;curtop+=a.offsetTop}while(a=a.offsetParent)}return{left:b,top:curtop}}function objSize(c){var a=0;for(var b in c){if(c.hasOwnProperty(b)){a++}}return a}function loadXMLDocFromString(a){try{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(a);return(xmlDoc)}catch(b){try{parser=new DOMParser();xmlDoc=parser.parseFromString(a,"text/xml");return(xmlDoc)}catch(b){alert(b.message)}}return(null)}if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/common/helperfunctions.js")}View.prototype.loadProject=function(b,a,c){eventManager.fire("loadingProjectStart");this.project=createProject(createContent(b),a,c,this);eventManager.fire("loadingProjectComplete")};View.prototype.getProject=function(){return this.project};View.prototype.injectVleUrl=function(b){var c=window.location.toString();var a=c.substring(0,c.indexOf("/vle/"))+"/vle/";b=b.replace(/(src='|src="|href='|href=")(?!http|\/)/gi,"$1"+a);return b};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/view/coreview.js")}View.prototype.utils={};View.prototype.utils.containsApplet=function(a){var b=a.getContentString();if(b.indexOf("<applet")!=-1&&b.indexOf("</applet>")!=-1){return true}else{return false}};View.prototype.utils.insertAppletParam=function(b,a,c){var e=b.getContentString();var d='<param name="'+a+'" value="'+c+'">';if(e.indexOf(d)==-1){b.setContent(e.replace("</applet>",d+"\n</applet>"))}};View.prototype.utils.getContentPath=function(b,a){return a.substring(a.indexOf(b)+b.length,a.length)};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/view/view_utils.js")}function ConnectionManager(a){this.em=a;this.MAX=5;this.queue=[];this.running=0;this.counter=0}ConnectionManager.prototype.request=function(f,d,c,a,e,h,g){var b;if(f=="GET"){b=new GetConnection(d,c,a,e,h,this.em,g)}else{if(f=="POST"){b=new PostConnection(d,c,a,e,h,this.em,g)}else{alert("unknown connection type: "+f+"\nExiting...");return}}this.queue.push(b);this.launchNext()};ConnectionManager.prototype.launchNext=function(){if(this.queue.length>0){if(this.running<this.MAX){this.queue.sort(this.orderByPriority);var a=this.queue.shift();var c=this.generateEventName();var b=function(e,d,f){f.running--;f.launchNext()};this.em.addEvent(c);this.em.subscribe(c,b,this);this.running++;a.startRequest(c)}}};ConnectionManager.prototype.orderByPriority=function(d,c){if(d.priority<c.priority){return -1}if(d.priority>c.priority){return 1}if(d.priority==c.priority){return 0}};ConnectionManager.prototype.generateEventName=function(){while(true){var a="connectionEnded"+this.counter;if(!this.em.isEvent(a)){return a}this.counter++}};function Connection(d,b,a,e,f,c){this.em=c}Connection.prototype.startRequest=function(a){var b=a;var c={success:function(d){this.em.fire(b);if((d.responseText&&!d.responseXML)||(typeof ActiveXObject!="undefined")){d.responseXML=loadXMLString(d.responseText)}if(d.responseText!="undefined"&&d.getResponseHeader["Content-Length"]<10000&&d.responseText.match("login for portal")!=null){if(notificationManager){notificationManager.notify("You have been inactive for too long and have been logged out. Please log back in to continue.",3)}else{alert("You have been inactive for too long and have been logged out. Please log back in to continue.")}vle.logout=true;window.location="/webapp/j_spring_security_logout"}this.handler(d.responseText,d.responseXML,this.hArgs)},failure:function(e){this.em.fire(b);if(this.fHandler){this.fHandler(e,this.hArgs)}else{var d="Connection request failed: transactionId="+e.tId+"  TEXT="+e.statusText;if(notificationManager){notificationManager.notify(d,2)}else{alert(d)}}},scope:this};YAHOO.util.Connect.asyncRequest(this.type,this.url,c,this.params)};GetConnection.prototype=new Connection();GetConnection.prototype.constructor=GetConnection;GetConnection.prototype.parent=Connection.prototype;function GetConnection(d,b,a,e,g,c,f){this.type="GET";this.priority=d;this.em=c;this.url=b;this.cArgs=a,this.handler=e;this.hArgs=g;this.fHandler=f;this.params=null;this.parseConnectionArgs()}GetConnection.prototype.parseConnectionArgs=function(){var b=true;if(this.url.indexOf("?")>-1){b=false}if(this.cArgs){for(var a in this.cArgs){if(b){b=false;this.url+="?"}else{this.url+="&"}this.url+=a+"="+this.cArgs[a]}}};PostConnection.prototype=new Connection();PostConnection.prototype.constructor=PostConnection;PostConnection.prototype.parent=Connection.prototype;function PostConnection(d,b,a,e,g,c,f){this.type="POST";this.priority=d;this.em=c;this.url=b;this.cArgs=a,this.handler=e;this.hArgs=g;this.fHandler=f;this.params=null;this.parseConnectionArgs()}PostConnection.prototype.parseConnectionArgs=function(){var b=true;if(this.cArgs){this.params="";for(var a in this.cArgs){if(b){b=false}else{this.params+="&"}this.params+=a+"="+this.cArgs[a]}}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/io/ConnectionManager.js")}var notificationManager={init:function(){window.notificationEventManager=new EventManager();notificationEventManager.addEvent("removeMsg")}(),count:0,debugMode:false,levels:{1:"info",2:"warn",3:"alert",4:"log",5:"fatal"},notify:function(a,c){if(c){var b=this.levels[c];if(this.debugMode){if(window.console){if(!b){b="log"}if(b=="alert"){b="error"}window.console[b]("Notify debug: "+a)}else{this.notifyAlert("Notify debug: "+a)}}else{if(b){if(b=="alert"){this.notifyAlert("Notify message: "+a)}else{if(b=="fatal"){eventManager.fire("fatalError",a)}else{if(b!="log"){if(window.console&&window.console[b]){window.console[b](a)}else{}}}}}}}else{this.notifyAlert("Notify message: "+a)}},notifyAlert:function(b){var a=this.generateUniqueMessageDiv();document.body.appendChild(a);new AlertObject(a,b)},generateUniqueMessageDiv:function(){var b="superSecretMessageDiv_"+this.count;if(document.getElementById(b)){this.count++;return generateUniqueMessageDiv()}else{var a=createElement(document,"div",{id:b,"class":"messages",style:"display:none;"});this.count++;return a}}};function AlertObject(a,b){this.MSG_TIME=3000;this.el=a;this.msg=b;notificationEventManager.subscribe("removeMsg",this.removeMsg,this);a.style.display="block";a.innerHTML=b;a.style.left=(document.body.clientWidth/2)-150;setTimeout('notificationEventManager.fire("removeMsg","'+a.id+'")',this.MSG_TIME)}AlertObject.prototype.removeMsg=function(b,a,c){if(a[0]==c.el.id){document.body.removeChild(c.el);c=null}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/util/NotificationManager.js")}function createContent(a){return function(d){var d=d;var n;var f;var p;var l=false;var k=30000;var e;var g=function(r){if(typeof eventManager!="undefined"){eventManager.fire("alert",r)}else{alert(r)}};var j=function(r){if(l){return q(r)}else{return c(r)}};var q=function(r){if(r=="xml"){return f}else{if(r=="json"){return p}else{if(r=="string"){return n}else{return null}}}};var c=function(r){e=setTimeout('eventManager.fire("contentTimedOut","'+d+'")',k);var s=new XMLHttpRequest();s.open("GET",d,false);s.send(null);clearTimeout(e);if(s.responseText||s.responseXML){if(s.responseXML){f=s.responseXML}else{b(s.responseText)}if(s.responseText){n=s.responseText}else{if(window.ActiveXObject){n=s.responseXML.xml}else{n=(new XMLSerializer()).serializeToString(s.responseXML)}}try{p=yui.JSON.parse(n)}catch(t){p=undefined}l=true;return q(r)}else{g("Error retrieving content for url: "+d);return null}};var h=function(r){if(typeof r=="string"){n=r;b(n);try{p=yui.JSON.parse(n)}catch(s){p=undefined}}else{if(window.ActiveXObject){if(r.xml){f=r;n=r.xml;try{p=yui.JSON.parse(n)}catch(s){p=undefined}}else{p=r;try{n=yui.JSON.stringify(p);b(n)}catch(s){p=undefined}}}else{if(r instanceof Document){f=r;n=(new XMLSerializer()).serializeToString(f);try{p=yui.JSON.parse(n)}catch(s){p=undefined}}else{p=r;try{n=yui.JSON.stringify(p);b(n)}catch(s){n=undefined}}}}l=true};var m=function(r){if(window.ActiveXObject){if(r.xml.length==0){return false}else{return true}}else{return r.getElementsByTagName("parsererror").length<1}};var b=function(r){if(document.implementation&&document.implementation.createDocument){f=new DOMParser().parseFromString(r,"text/xml")}else{if(window.ActiveXObject){f=new ActiveXObject("Microsoft.XMLDOM");f.loadXML(r)}}if(!m(f)){f=undefined}};var o=function(r){return d.substring(d.indexOf(r)+r.length+1,d.length)};return{getContentXML:function(){return j("xml")},getContentJSON:function(){return j("json")},getContentString:function(){return j("string")},setContent:function(r){h(r)},retrieveContent:function(){j("string")},getContentUrl:function(){return d},getFilename:function(r){return o(r)}}}(a)}if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/content/content.js")}var SELF_RENDERING_NODES=["BlueJNode","DrawNode","FlashNode","HtmlNode","MySystemNode","SVGDrawNode"];var HTML_MAP={BrainstormNode:{server:"node/brainstorm/brainfull.html",serverless:"node/brainstorm/brainlite.html"},ChallengeQuestionNode:"node/challengequestion/challengequestion.html",DataGraphNode:"node/datagraph/datagraph.html",FillinNode:"node/fillin/fillin.html",GlueNode:"node/glue/glue.html",MatchSequenceNode:"node/matchsequence/matchsequence.html",MultipleChoiceNode:"node/multiplechoice/multiplechoice.html",NoteNode:"node/openresponse/note.html",OpenResponseNode:"node/openresponse/openresponse.html",OutsideUrlNode:"node/outsideurl/outsideurl.html",TickerNode:"node/ticker/ticker.html"};function removeClassFromElement(a,b){YUI().use("node",function(d){var c=d.get("#"+a);c.removeClass(b)})}function addClassToElement(a,b){YUI().use("node",function(d){var c=d.get("#"+a);c.addClass(b)})}function hasClass(a,b){var c=document.getElementById(a).getAttribute("class");return c!=null&&(c.indexOf(b)!=-1)}function clearFeedbackDiv(){document.getElementById("feedbackDiv").innerHTML=""}function clearResponseBox(){document.getElementById("responseBox").value=""}function setButtonVisible(c,b){var a=document.getElementById(c);if(b){a.style.visibility="visible"}else{a.style.visibility="hidden"}}function setCheckAnswerButtonEnabled(a){var b=document.getElementById("checkAnswerButton");if(a){b.removeAttribute("disabled")}else{b.setAttribute("disabled","true")}}function setResponseBoxEnabled(b){var a=document.getElementById("responseBox");if(b){a.removeAttribute("disabled")}else{a.setAttribute("disabled","disabled")}}function displayNumberAttempts(f,d,b){var c=b.length+1;var a="";if(c==1){a="1st"}else{if(c==2){a="2nd"}else{if(c==3){a="3rd"}else{a=c+"th"}}}var e=document.getElementById("numberAttemptsDiv");var g=f+" "+a+" "+d+".";e.innerHTML=g}function displayLastAttempt(c){if(c.length>0){var e=c[c.length-1].timestamp;var g=e.getMonth()+1;var a=e.getHours();var d=e.getMinutes();var h=e.getSeconds();var b=g+"/"+e.getDate()+"/"+e.getFullYear()+" at "+a+":"+d+":"+h;var f=document.getElementById("lastAttemptDiv");f.innerHTML=" Your last attempt was on "+b}}function makeHtmlSafe(a){if(a){a=a.replace(/\&/g,"&amp;");a=a.replace(/\"/g,"&quot;");return a}else{return""}}if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/common/nodehelpers.js")}function createProject(c,b,d,a){return function(u,x,M,k){var u=u;var Z=x;var K=M;var E=[];var P=[];var W;var ae;var L;var q;var p;var k=k;var v=[];var D=function(){var al=u.getContentJSON().nodes;for(var ak=0;ak<al.length;ak++){var ai=al[ak];var aj=NodeFactory.createNode(ai,k);if(aj==null){k.notificationManager.notify("null was returned from project factory for node: "+ai.identifier+" \nSkipping node.",2)}else{if(!ai.identifier||ai.identifier==""){k.notificationManager.notify("No identifier for node in project file.",3)}else{aj.id=ai.identifier;if(ac(aj.id)){k.notificationManager.notify("Duplicate node id: "+aj.id+" found in project",3)}}if(!ai.title||ai.title==""){k.notificationManager.notify("No title attribute for node with id: "+aj.id,2)}else{aj.title=ai.title}if(!ai["class"]||ai["class"]==""){k.notificationManager.notify("No class attribute for node with id: "+aj.id,2)}else{aj.className=ai["class"]}if(!ai.ref||ai.ref==""){k.notificationManager.notify("No filename specified for node with id: "+aj.id+" in the project file",2)}else{aj.content=createContent(y(ai.ref))}E.push(aj);if(!K){aj.content.retrieveContent()}if(aj.type=="NoteNode"){aj.renderFrame()}aj.prevWorkNodeIds=ai.previousWorkNodeIds;eventManager.subscribe("pageRenderComplete",aj.pageRenderComplete,aj);eventManager.subscribe("contentRenderComplete",aj.contentRenderComplete,aj);eventManager.subscribe("scriptsLoaded",aj.loadContentAfterScriptsLoad,aj)}}};var S=function(){var an=u.getContentJSON();var ao=an.sequences;for(var am=0;am<ao.length;am++){var aj=NodeFactory.createNode(ao[am],k);aj.json=ao[am];if(ac(aj.id)){k.notificationManager.notify("Duplicate sequence id: "+aj.id+" found in project.",3)}P.push(aj)}if(an.startPoint){var ak=ab(an.startPoint)}else{k.notificationManager.notify("No starting sequence specified for this project",3)}if(ak){for(var al=0;al<P.length;al++){var ai=[];if(ag(P[al].id,ai,"file")){r(P[al].id)}else{k.notificationManager.notify("Infinite loop discovered in sequences, check sequence references",3);return null}}p=ak}};var ac=function(ai){return ab(ai)};var ab=function(ak){for(var ai=0;ai<E.length;ai++){if(E[ai].id==ak){return E[ai]}}for(var aj=0;aj<P.length;aj++){if(P[aj].id==ak){return P[aj]}}return null};var A=function(ai){if(ai){var al=ai.split(".");var ak=p;var am;for(var aj=0;aj<al.length;aj++){am=ak.children[al[aj]];if(!am){return null}else{if(aj==al.length-1){return am}else{ak=am}}}}else{return null}};var y=function(ai){if(Z!=null){if(Z.lastIndexOf("\\")!=-1){return Z+"\\"+ai}else{return Z+"/"+ai}}return ai};var ag=function(am,aj,al){if(aj.indexOf(am)==-1){var ak=n(am,al);if(ak.length>0){aj.push(am);for(var ai=0;ai<ak.length;ai++){if(!ag(ak[ai],aj)){return false}}aj.pop(am);return true}else{return true}}else{return false}};var r=function(am){var al=ab(am);var ak=al.json.refs;for(var ai=0;ai<ak.length;ai++){var aj=ab(ak[ai]);if(!aj){k.notificationManager.notify("Node reference "+ak[ai]+" exists in sequence node "+am+" but the node has not been defined and does not exist.",2)}else{al.addChildNode(aj)}}};var n=function(ao,an){var am=ab(ao);if(!am){k.notificationManager.notify("Sequence with id: "+ao+" is referenced but this sequence does not exist.",2);return[]}var ai=[];if(an=="file"){var aj=am.json.refs;for(var al=0;al<aj.length;al++){ai.push(aj[al])}}else{var ak=am.children;for(var al=0;al<ak.length;al++){if(ak[al].type=="sequence"){ai.push(ak[al].id)}}}return ai};var g=function(aj){for(var ak=0;ak<E.length;ak++){if(E[ak].title==aj){return E[ak]}}for(var ai=0;ai<P.length;ai++){if(P[ai].title==aj){return P[ai]}}return null};var Y=function(ai){if(ai){if(ai.type=="sequence"){for(var ak=0;ak<ai.children.length;ak++){var aj=Y(ai.children[ak]);if(aj!=null){return aj}}}else{return ai.id}}else{k.notificationManager.notify("Cannot get start node! Possibly no start sequence is specified or invalid node exists in project.",2)}};var o=function(ak){for(var ai=0;ai<P.length;ai++){for(var aj=0;aj<P[ai].children.length;aj++){if(P[ai].children[aj].id==ak){P[ai].children.splice(aj,1)}}}};var f=function(ai,aj){if(ai.type=="sequence"){for(var al=0;al<ai.children.length;al++){var ak=f(ai.children[al],aj+"."+al);if(ak!=undefined&&ak!=null){return ak}}}else{return aj}};var ah=function(ai,ak,am){if(ai.id==am){return ak}else{if(ai.type=="sequence"){for(var aj=0;aj<ai.children.length;aj++){var al=ah(ai.children[aj],ak+"."+aj,am);if(al){return al}}}}};var V=function(){s();ad();G();O();h();T()};var s=function(){var ai="Sequences defined by Id: ";for(var aj=0;aj<P.length;aj++){if(aj==P.length-1){ai+=" "+P[aj].id}else{ai+=" "+P[aj].id+","}}k.notificationManager.notify(ai,1)};var ad=function(){var aj="Nodes defined by Id: ";for(var ai=0;ai<E.length;ai++){if(ai==E.length-1){aj+=" "+E[ai].id}else{aj+=" "+E[ai].id+","}}k.notificationManager.notify(aj,1)};var G=function(){var ak="Sequence(s) with id(s): ";var aj=false;for(var ai=0;ai<P.length;ai++){if(!R(P[ai].id)&&P[ai].id!=p.id){aj=true;ak+=" "+P[ai].id}}if(aj){k.notificationManager.notify(ak+" is/are never used in this project",1)}};var O=function(){var ak="Node(s) with id(s): ";var aj=false;for(var ai=0;ai<E.length;ai++){if(!R(E[ai].id)){aj=true;ak+=" "+E[ai].id}}if(aj){k.notificationManager.notify(ak+" is/are never used in this project",1)}};var h=function(){var al="Duplicate sequence Id(s) are: ";var ak=false;for(var am=0;am<P.length;am++){var aj=0;for(var ai=0;ai<P.length;ai++){if(P[am].id==P[ai].id){aj++}}if(aj>1){ak=true;al+=P[am].id+" "}}if(ak){k.notificationManager.notify(al,1)}};var T=function(){var al="Duplicate node Id(s) are: ";var ak=false;for(var am=0;am<E.length;am++){var aj=0;for(var ai=0;ai<E.length;ai++){if(E[am].id==E[ai].id){aj++}}if(aj>1){ak=true;al+=E[am].id+" "}}if(ak){k.notificationManager.notify(al,1)}};var R=function(ak){for(var aj=0;aj<P.length;aj++){for(var ai=0;ai<P[aj].children.length;ai++){if(P[aj].children[ai].id==ak){return true}}}return false};var I=function(ak){var al=[];if(ak=="node"){var aj=E}else{var aj=P}for(var ai=0;ai<aj.length;ai++){if(!R(aj[ai].id)&&!(p==aj[ai])){al.push(aj[ai])}}return al};var Q=function(aj){var al="";for(var ai=0;ai<E.length;ai++){var am=E[ai];var an=am.id;var ak=am.type;if(aj.indexOf(ak)==-1){if(al!=""){al+=":"}al+=an}}return al};var F=function(ak){var aj="";for(var ai=0;ai<E.length;ai++){var am=E[ai];var al=am.type;if(ak.indexOf(al)==-1){if(aj!=""){aj+=":"}aj+=al}}return aj};var J=function(al,an){var am="";if(al.children.length>0){for(var ak=0;ak<al.children.length;ak++){am+=J(al.children[ak],an)}}else{am+='<div id="showallStep"><a href="#" onclick="view.renderNode(\''+X(al.id)+"'); YAHOO.example.container.showallwork.hide();\">"+al.title+'</a><div class="type">'+al.getType(true)+"</div></div>";if(an){am+='<div class="showallStatus">Status: '+al.getShowAllWorkHtml(k)+"</div>";am+="<div><table id='teacherTable'>";var aj=k.annotations.getAnnotationsByNodeId(al.id);if(aj.length>0){for(var ak=0;ak<aj.length;ak++){var ai=aj[ak];if(ai.type=="comment"){am+="<tr><td class='teachermsg1'>TEACHER FEEDBACK: "+ai.value+"</td></tr>"}if(ai.type=="score"){am+="<tr><td class='teachermsg2'>TEACHER SCORE: "+ai.value+"</td></tr>"}}}else{am+="<td class='teachermsg3'>Grading: Your Teacher hasn't graded this step yet.<td>"}am+="</table></div>"}else{am+=al.getShowAllWorkHtml(k)}am+=""}return am};var t=function(ak){for(var aj=0;aj<P.length;aj++){if(P[aj].id==ak){P.splice(aj,1);o(ak);return}}for(var ai=0;ai<E.length;ai++){if(E[ai].id==ak){E.splice(ai,1);o(ak);return}}};var m=function(ak,ai){var aj=ab(ak);aj.children.splice(ai,1)};var H=function(am,ak,aj){var al=ab(am);var an=ab(ak);an.children.splice(aj,0,al);var ai=[];if(!ag(ak,ai)){k.notificationManager.notify("This would cause an infinite loop! Undoing changes...",3);an.children.splice(aj,1)}};var aa=function(){var ak={autoStep:W,stepLevelNum:ae,stepTerm:q,title:L,nodes:[],sequences:[],startPoint:""};if(p){ak.startPoint=p.id}for(var ai=0;ai<E.length;ai++){ak.nodes.push(E[ai].nodeJSON(Z))}for(var aj=0;aj<P.length;aj++){ak.sequences.push(P[aj].nodeJSON())}return ak};var U=function(){for(var aj=0;aj<p.children.length;aj++){var ai=f(p.children[aj],aj);if(ai!=undefined&&ai!=null){return ai}}};var X=function(ak){for(var aj=0;aj<p.children.length;aj++){var ai=ah(p.children[aj],aj,ak);if(ai!=undefined&&ai!=null){return ai}}};var C=function(){var ai=u.getContentUrl();return ai.substring(ai.indexOf(Z)+Z.length+1,ai.length)};var B=function(aj){var ai=ab(aj);if(ai){return ai.content.getFilename(Z)}else{return null}};var af=function(aj){var ai=1;while(true){var ak=aj+" "+ai;if(!g(ak)){return ak}ai++}};var w=function(ak){var aj=1;while(true){var ai=ak+"_"+aj;if((!ab(ai))&&(v.indexOf(ai)==-1)){return ai}aj++}};var j=function(ak,ai){var an=function(at,ar,ax){var aw=ar[0];var ap=ar[1];var av=ax;var au=av.queue.shift();if(au.id!=aw){av.view.notificationManager("Copied node id and node id from queue do match, error when copying.",3)}if(!ap){av.msg+=" Failed copy of "+aw}else{av.msg+=" Copied "+aw+" to "+ap;av.view.getProject().addCopyId(ap);av.copiedIds.push(ap)}if(av.queue.length>0){var aq=av.queue[0];aq.node.copy(aq.eventName)}else{av.view.eventManager.fire(av.eventName,[av.copiedIds,av.msg])}};var al={view:k,queue:[],eventName:ai,msg:"",copiedIds:[]};for(var am=0;am<ak.length;am++){var aj=z();al.queue.push({id:ak[am],node:ab(ak[am]),eventName:aj});k.eventManager.addEvent(aj);k.eventManager.subscribe(aj,an,al)}if(al.queue.length>0){var ao=al.queue[0];ao.node.copy(ao.eventName)}else{k.eventManager.fire(ai,[null,null])}};var z=function(){return k.eventManager.generateUniqueEventName("copy_")};var N=function(ai){v.push(ai)};var l=function(ao){var an=ab(ao);var am=an.content;var al=am.getContentJSON();var ai=null;if(al.assessmentItem!=null){var ak=al.assessmentItem;var aj=ak.interaction;ai=aj.prompt}return ai};var e=u.getContentJSON();if(e){W=e.autoStep;ae=e.stepLevelNum;q=e.stepTerm;L=e.title;D();S();V()}else{k.notificationManager.notify("Unable to parse project content, check project.json file. Unable to continue.",5)}return{useAutoStep:function(){return W},setAutoStep:function(ai){W=ai},useStepLevelNumbering:function(){return ae},setStepLevelNumbering:function(ai){ae=ai},getStepTerm:function(){return q},setStepTerm:function(ai){q=ai},getTitle:function(){return L},setTitle:function(ai){L=ai},getNodeById:function(ai){return ab(ai)},validateNoLoops:function(ak,ai,aj){return ag(ak,ai,aj)},getNodeByTitle:function(ai){return g(ai)},getNodeByPosition:function(ai){return A(ai)},getNodeIds:function(ai){return Q(ai)},getNodeTypes:function(ai){return F(ai)},getShowAllWorkHtml:function(ai,aj){return J(ai,aj)},getStartNodeId:function(){return Y(p)},removeNodeById:function(ai){t(ai)},removeReferenceFromSequence:function(aj,ai){m(aj,ai)},addNodeToSequence:function(ak,aj,ai){H(ak,aj,ai)},copyNodes:function(aj,ai){j(aj,ai)},getStartNodePosition:function(){return U()},getPositionById:function(ai){return X(ai)},getContentBase:function(){return Z},getProjectFilename:function(){return C()},getUrl:function(){return u.getContentUrl()},getLeafNodes:function(){return E},getSequenceNodes:function(){return P},getRootNode:function(){return p},getUnattached:function(ai){return I(ai)},getNodeFilename:function(ai){return B(ai)},generateUniqueTitle:function(ai){return af(ai)},generateUniqueId:function(ai){return w(ai)},generateUniqueCopyEventName:function(){return z()},addCopyId:function(ai){N(ai)},projectJSON:function(){return aa()},makeUrl:function(ai){return y(ai)},getNodePromptByNodeId:function(ai){return l(ai)}}}(c,b,d,a)}if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/project/Project.js")}function NodeFactory(){}NodeFactory.createNode=function(c,b){var d=new Array("node","HtmlNode","MultipleChoiceNode","sequence","FillinNode","MatchSequenceNode","NoteNode","JournalEntryNode","OutsideUrlNode","BrainstormNode","GlueNode","OpenResponseNode","FlashNode","BlueJNode","DataGraphNode","DrawNode","MySystemNode","SVGDrawNode");if(c.type){var e=c.type}else{var e=null}if(d.indexOf(e)>-1){if(e=="HtmlNode"){return new HtmlNode("HtmlNode",b)}else{if(e=="MultipleChoiceNode"){return new MultipleChoiceNode("MultipleChoiceNode",b)}else{if(e=="FillinNode"){return new FillinNode("FillinNode",b)}else{if(e=="NoteNode"){return new NoteNode("NoteNode",b)}else{if(e=="JournalEntryNode"){return new JournalEntryNode("JournalEntryNode",b)}else{if(e=="MatchSequenceNode"){return new MatchSequenceNode("MatchSequenceNode",b)}else{if(e=="OutsideUrlNode"){return new OutsideUrlNode("OutsideUrlNode",b)}else{if(e=="BrainstormNode"){return new BrainstormNode("BrainstormNode",b)}else{if(e=="FlashNode"){return new FlashNode("FlashNode",b)}else{if(e=="GlueNode"){return new GlueNode("GlueNode",b)}else{if(e=="OpenResponseNode"){return new OpenResponseNode("OpenResponseNode",b)}else{if(e=="BlueJNode"){return new BlueJNode("BlueJNode",b)}else{if(e=="DataGraphNode"){return new DataGraphNode("DataGraphNode",b)}else{if(e=="DrawNode"){return new DrawNode("DrawNode",b)}else{if(e=="MySystemNode"){return new MySystemNode("MySystemNode",b)}else{if(e=="SVGDrawNode"){return new SVGDrawNode("SVGDrawNode",b)}else{if(e=="sequence"){var a=new Node("sequence",b);a.id=c.identifier;a.title=c.title;return a}else{return new Node(null,b)}}}}}}}}}}}}}}}}}}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/nodefactory.js")}function Node(b,a){this.id;this.parent;this.children=[];this.type=b;this.title;this.className;this.content;this.contentPanel;this.baseHtmlContent;this.prevWorkNodeIds=[];this.extraData;this.view=a}Node.prototype.getNodeId=function(){return this.id};Node.prototype.getTitle=function(){if(this.title!=null){return this.title}return this.id};Node.prototype.getContent=function(){return this.content};Node.prototype.setContent=function(a){this.content=a};Node.prototype.getType=function(a){if(this.type){if(!a){return this.type}else{if(this.type.lastIndexOf("Node")>-1){return this.type.substring(0,this.type.lastIndexOf("Node"))}else{return this.type}}}else{return""}};Node.prototype.addChildNode=function(a){this.children.push(a);a.parent=this};Node.prototype.getNodeById=function(c){if(this.id==c){return this}else{if(this.children.length==0){return null}else{var a=false;for(var b=0;b<this.children.length;b++){a=a||this.children[b].getNodeById(c)}return a}}};Node.prototype.alertNodeInfo=function(a){notificationManager.notify("node.js, "+a+"\nthis.id:"+this.id+"\nthis.title:"+this.title,3)};Node.prototype.render=function(c,a){this.studentWork=a;this.contentPanel=c;if(c){this.contentPanel=window.frames[c.name]}else{if(c==null){if(this.type=="NoteNode"){this.contentPanel=window.frames["noteiframe"+this.id];document["notePanel_"+this.id].cfg.setProperty("visible",true)}else{this.contentPanel=window.frames.ifrm}}}if(SELF_RENDERING_NODES.indexOf(this.type)==-1){if(this.contentPanel.nodeId!=this.id){var b=HTML_MAP[this.type];if(this.type=="BrainstormNode"){if(this.isUsingServer()){b=b.server}else{b=b.serverless}}this.baseHtmlContent=createContent(b);this.contentPanel.nodeId=this.id;this.contentPanel.document.open();this.contentPanel.document.write(this.injectBaseRef(this.view.injectVleUrl(this.baseHtmlContent.getContentString())));this.contentPanel.document.close()}else{this.contentPanel.loadContentAfterScriptsLoad(this)}}else{if(!this.baseHtmlContent){this.baseHtmlContent=createContent(this.view.getProject().makeUrl(this.content.getContentJSON().src));if(this.type=="MySystemNode"){this.baseHtmlContent.setContent(this.updateJSONContentPath(this.view.getConfig().getConfigParam("getContentBaseUrl"),this.baseHtmlContent.getContentString()))}}if(this.handlePreviousOutsideLink(this)){return}this.contentPanel.document.open();this.contentPanel.document.write(this.injectBaseRef(this.baseHtmlContent.getContentString()));this.contentPanel.document.close();this.view.eventManager.fire("contentRenderComplete",this.id)}if(this.contentPanel!=null){this.contentPanel.eventManager=eventManager;this.contentPanel.nodeId=this.id;this.contentPanel.scriptloader=this.view.scriptloader;this.contentPanel.yui=yui;if(this.type=="MySystemNode"||this.type=="SVGDrawNode"){this.contentPanel.vle=this.view}}if(this.content.getContentJSON().blueJProjectPath&&this.content.getContentJSON().blueJProjectPath!=""&&this.view.postCurrentStep){this.extraData=this.content.getContentJSON.blueJProjectPath;this.view.postCurrentStep(this)}};Node.prototype.pageRenderComplete=function(b,a,c){if(c.id==a[0]){c.contentPanel.loadContent(c);c.insertPreviousWorkIntoPage(c.contentPanel.document)}};Node.prototype.loadContentAfterScriptsLoad=function(b,a,c){if(c.id==a[0]){c.contentPanel.loadContentAfterScriptsLoad(c)}};Node.prototype.contentRenderComplete=function(b,a,c){};Node.prototype.onExit=function(){};Node.prototype.getView=function(){if(this.isSequence()){if(this.json.view==null){return"normal"}else{return this.json.view}}else{return null}};Node.prototype.isSequence=function(){return this.type=="sequence"};Node.prototype.nodeJSON=function(b){if(this.type=="sequence"){var d={type:"sequence",identifier:makeHtmlSafe(this.id),title:makeHtmlSafe(this.title),view:this.getView(),refs:[]};for(var a=0;a<this.children.length;a++){d.refs.push(this.children[a].id)}return d}else{var c={type:this.type,identifier:makeHtmlSafe(this.id),title:makeHtmlSafe(this.title),ref:this.content.getFilename(b),previousWorkNodeIds:this.prevWorkNodeIds};c["class"]=this.className;return c}};Node.prototype.getLatestWork=function(b,a){return null};Node.prototype.translateStudentWork=function(a){return a};Node.prototype.injectBaseRef=function(c){if(c.search(/<base/i)>-1){return c}else{var b=this.view.getConfig().getConfigParam("getContentBaseUrl");var d="<base href='"+b+"'/>";var a=c.replace("<head>","<head>"+d);return a}};Node.prototype.isLeafNode=function(){return this.type!="sequence"};Node.prototype.getDataXML=function(d){var c="";for(var a=0;a<d.length;a++){var b=d[a];c+="<state>"+b.getDataXML()+"</state>"}return c};Node.prototype.parseDataXML=function(b){var a=b.getElementsByTagName("type")[0].textContent;var d=b.getElementsByTagName("id")[0].textContent;var c=NodeFactory.createNode(a);c.id=d;return c};Node.prototype.handlePreviousOutsideLink=function(c,a){if(!window.frames.ifrm){return false}else{try{window.frames.ifrm.host}catch(b){history.back();setTimeout(function(){c.render(a)},500);return true}return false}};Node.prototype.insertPreviousWorkIntoPage=function(e){if(this.prevWorkNodeIds.length>0){var c="";for(var f=0;f<this.prevWorkNodeIds.length;f++){var b=vle.getLatestWorkByNodeId(this.prevWorkNodeIds[f]);if(b){var d=vle.project.getNodeById(this.prevWorkNodeIds[f]);c+="Remember, your response to step "+d.title+" was: "+b.getStudentWork()+"</br></br>"}}var a=e.getElementById("previousWorkDiv");if(a){a.innerHTML=c}}};Node.prototype.copy=function(f,h){var k=function(n,l,m){m[0].view.eventManager.fire(m[1],[m[0].id,n])};var j=function(l,m){m[0].view.eventManager.fire(m[1],m[0].id)};if(this.type!="sequence"){var h=this.view.getProject();var d=this.content.getContentString();if(this.type=="HtmlNode"||this.type=="DrawNode"||this.type=="MySystemNode"){var c=this.content.getContentJSON().src}else{var c=""}if(this.type=="MySystemNode"){this.view.notificationManager.notify("My System Nodes cannot be copied, ignoring",3);this.view.eventManager.fire(f,[this.id,null]);return}this.view.connectionManager.request("POST",1,"filemanager.html",{command:"copyNode",param1:this.view.utils.getContentPath(this.view.authoringBaseUrl,h.getUrl()),param2:this.content.getContentString(),param3:this.type,param4:h.generateUniqueTitle(this.title),param5:this.className,param6:c},k,[this,f],j)}else{var a=function(s,r,o){if(r[0]){var p=r[0]}else{var p=[]}if(r[1]){var l=r[1]}else{var l=""}var m=o[0];var q=o[1];var t=m.view.getProject();var n={type:"sequence",identifier:t.generateUniqueId(m.id),title:t.generateUniqueTitle(m.title),view:m.getView(),refs:p};m.view.connectionManager.request("POST",1,"filemanager.html",{command:"createSequenceFromJSON",param1:m.view.utils.getContentPath(m.view.authoringBaseUrl,m.view.getProject().getUrl()),param2:yui.JSON.stringify(n)},k,[m,q],j)};var e=this.view.project.generateUniqueCopyEventName();this.view.eventManager.addEvent(e);this.view.eventManager.subscribe(e,a,[this,f]);var b=[];for(var g=0;g<this.children.length;g++){b.push(this.children[g].id)}this.view.getProject().copyNodes(b,e)}};Node.prototype.getShowAllWorkHtml=function(h){var d="";var g=h.state.getNodeVisitsByNodeId(this.id);if(g.length>0){var k=[];var b=g[g.length-1];for(var c=0;c<g.length;c++){var e=g[c];for(var a=0;a<e.nodeStates.length;a++){k.push(e.nodeStates[a])}}var f=k[k.length-1];d+="Last visited on ";if(b!=null){d+=""+new Date(parseInt(b.visitStartTime)).toLocaleString()}if(f!=null){d+='<div class="showallLatest">Latest Work:</div><div class="showallLatestWork">'+this.translateStudentWork(f.getStudentWork())+"</div>"}}else{d+="Step not visited yet."}for(var c=0;c<this.children.length;c++){d+=this.children[c].getShowAllWorkHtml()}return d};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/Node.js")}OpenResponseNode.prototype=new Node();OpenResponseNode.prototype.constructor=OpenResponseNode;OpenResponseNode.prototype.parent=Node.prototype;function OpenResponseNode(b,a){this.view=a;this.type=b;this.prevWorkNodeIds=[]}OpenResponseNode.prototype.render_old=function(b){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.contentLoaded){var a=function(e,c,d){d.contentPanel.document.open();d.contentPanel.document.write(d.injectBaseRef(injectVleUrl(e)));d.contentPanel.document.close();if(d.contentPanel.name!="ifrm"){d.contentPanel.renderComplete=function(){d.load()}}d.contentPanel.renderLoadComplete=function(){d.onNodefullyloaded()}};if(b){this.contentPanel=window.frames[b.name]}else{this.contentPanel=window.frames.ifrm}vle.connectionManager.request("GET",1,"node/openresponse/openresponse.html",null,a,this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,function(d,c,e){e[0].render(e[1])},[this,b])}};OpenResponseNode.prototype.load=function(){var b=[];for(var d=0;d<vle.state.visitedNodes.length;d++){var a=vle.state.visitedNodes[d];if(a.getNodeId()==this.id){for(var c=0;c<a.nodeStates.length;c++){b.push(a.nodeStates[c])}}}if(this.contentPanel&&this.contentPanel.loadContent){this.contentPanel.loadContent([this.element,vle,b])}if(this.contentPanel){this.insertPreviousWorkIntoPage(this.contentPanel.document)}};OpenResponseNode.prototype.renderLite=function(a){if(this.filename!=null&&vle.project.lazyLoading){this.retrieveFile()}if(a){this.liteState=a}var b=function(f,d,e){e.contentPanel.document.open();e.contentPanel.document.write(e.injectBaseRef(injectVleUrl(f)));e.contentPanel.document.close();e.contentPanel.renderComplete=function(){e.loadLite()}};var c={success:function(d){b(d.responseText,d.responseXML,d.argument)},failure:function(d){this.view.notificationManager.notify("failed to retrieve file",3)},argument:this};YAHOO.util.Connect.asyncRequest("GET","node/openresponse/openresponselite.html",c,null)};OpenResponseNode.prototype.loadLite=function(){if(this.contentPanel&&this.contentPanel.loadContent){this.contentPanel.loadContent([this.element,this,vle,this.liteState])}};OpenResponseNode.prototype.parseDataXML=function(d){var c=d.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var e=c[a];b.push(OPENRESPONSESTATE.prototype.parseDataXML(e))}return b};OpenResponseNode.prototype.getDataXML=function(a){return OpenResponseNode.prototype.parent.getDataXML(a)};OpenResponseNode.prototype.parseDataJSONObj=function(a){return OPENRESPONSESTATE.prototype.parseDataJSONObj(a)};OpenResponseNode.prototype.translateStudentWork=function(a){return a};OpenResponseNode.prototype.parseStateXML=function(a){return OPENRESPONSESTATE.prototype.parseDataXML(a)};OpenResponseNode.prototype.onExit=function(){if(this.contentPanel&&this.contentPanel.save){this.contentPanel.save()}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/OpenResponseNode.js")}HtmlNode.prototype=new Node();HtmlNode.prototype.constructor=HtmlNode;HtmlNode.prototype.parent=Node.prototype;function HtmlNode(b,a){this.view=a;this.type=b;this.audios=[];this.contentBase;this.audioSupported=true}HtmlNode.prototype.setHtmlContent=function(a){this.content.setContent(a)};HtmlNode.prototype.load=function(){this.prepareAudio();if(vle.audioManager!=null){vle.audioManager.setCurrentNode(this)}};HtmlNode.prototype.renderLite=function(a){if(this.filename!=null&&vle.project.lazyLoading){this.retrieveFile()}};HtmlNode.prototype.loadLite=function(a){if(!this.elementText){if(!this.htmlContent){this.elementText=this.element.getElementsByTagName("content")[0].firstChild.nodeValue;this.htmlContent=this.element.getElementsByTagName("content")[0].firstChild.nodeValue}else{this.elementText=this.htmlContent}}window.frames.ifrm.frames[a].document.open();window.frames.ifrm.frames[a].document.write(this.injectBaseRef(this.elementText));window.frames.ifrm.frames[a].document.close();window.frames.ifrm.frames[a].getAnswered=function(){return true};window.frames.ifrm.frames[a].checkAnswerLite=function(){return"visited html: "+this.id}};HtmlNode.prototype.getDataXML=function(a){return HtmlNode.prototype.parent.getDataXML(a)};HtmlNode.prototype.parseDataXML=function(d){var c=d.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var e=c[a];b.push(HTMLSTATE.prototype.parseDataXML(e))}return b};HtmlNode.prototype.parseDataJSONObj=function(a){return HTMLSTATE.prototype.parseDataJSONObj(a)};HtmlNode.prototype.exportNode=function(){var a="";a+=this.exportNodeHeader();a+="<content><![CDATA[";a+=this.element.getElementsByTagName("content")[0].firstChild.nodeValue;a+="]]></content>";a+=this.exportNodeFooter();return a};HtmlNode.prototype.doNothing=function(){window.frames.ifrm.document.open();window.frames.ifrm.document.write(this.injectBaseRef(this.elementText));window.frames.ifrm.document.close()};HtmlNode.prototype.onExit=function(){if(this.contentPanel){try{if(this.contentPanel.onExit){try{this.contentPanel.onExit()}catch(a){}}}catch(a){history.back()}}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/HtmlNode.js")}DrawNode.prototype=new HtmlNode();DrawNode.prototype.constructor=DrawNode;DrawNode.prototype.parent=HtmlNode.prototype;function DrawNode(b,a){this.view=a;this.type=b;this.content=null;this.audios=[];this.contentBase;this.audioSupported=true}if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/DrawNode.js")}MySystemNode.prototype=new HtmlNode();MySystemNode.prototype.constructor=MySystemNode;MySystemNode.prototype.parent=HtmlNode.prototype;function MySystemNode(b,a){this.view=a;this.type=b;this.content=null;this.filename=null;this.audios=[];this.contentBase;this.audioSupported=true}MySystemNode.prototype.updateJSONContentPath=function(b,c){this.filename="modules.json";var a=new RegExp(this.filename);var c=c.replace(a,b+"/"+this.filename);return c};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/MySystemNode.js")}MatchSequenceNode.prototype=new Node();MatchSequenceNode.prototype.constructor=MatchSequenceNode;MatchSequenceNode.prototype.parent=Node.prototype;function MatchSequenceNode(b,a){this.view=a;this.type=b;this.prevWorkNodeIds=[]}MatchSequenceNode.prototype.render_old=function(b){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.contentLoaded){var a=function(e,d,c){c.contentPanel.document.open();c.contentPanel.document.write(c.injectBaseRef(injectVleUrl(e)));c.contentPanel.document.close();if(c.contentPanel.name!="ifrm"){c.contentPanel.renderComplete=function(){c.load()}}};if(b){this.contentPanel=window.frames[b.name]}else{this.contentPanel=window.frames.ifrm}vle.connectionManager.request("GET",1,"node/matchsequence/matchsequence.html",null,a,this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,function(d,c,e){e[0].render(e[1])},[this,b])}};MatchSequenceNode.prototype.load=function(){var a=this.element.getElementsByTagName("customCheck");if(a[0]!=null){a=a[0].firstChild.nodeValue}else{a=null}this.contentPanel.loadContent(this.getXMLString(),a);this.insertPreviousWorkIntoPage(this.contentPanel.document)};MatchSequenceNode.prototype.getDataXML=function(a){return MatchSequenceNode.prototype.parent.getDataXML(a)};MatchSequenceNode.prototype.parseDataXML=function(e){var c=e.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var f=c[a];var d=MSSTATE.prototype.parseDataXML(f);if(d!=null){b.push(d)}}return b};MatchSequenceNode.prototype.onExit=function(){};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/MatchSequenceNode.js")}FillinNode.prototype=new Node();FillinNode.prototype.constructor=FillinNode;FillinNode.prototype.parent=Node.prototype;function FillinNode(b,a){this.view=a;this.type=b;this.prevWorkNodeIds=[]}FillinNode.prototype.render_old=function(b){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.contentLoaded){var a=function(e,c,d){if(d.filename!=null&&vle.project.lazyLoading){d.retrieveFile()}d.contentPanel.document.open();d.contentPanel.document.write(d.injectBaseRef(injectVleUrl(e)));d.contentPanel.document.close();if(d.contentPanel.name!="ifrm"){d.contentPanel.renderComplete=function(){d.load()}}};if(this.handlePreviousOutsideLink(this)){return}if(b){this.contentPanel=window.frames[b.name]}else{this.contentPanel=window.frames.ifrm}vle.connectionManager.request("GET",1,"node/fillin/fillin.html",null,a,this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,function(d,c,e){e[0].render(e[1])},[this,b])}};FillinNode.prototype.load=function(){var a=function(d,b,c){if(!c){c=d}c.contentPanel.loadContent([c.element,vle]);c.insertPreviousWorkIntoPage(c.contentPanel.document)};if(this.contentLoaded){a(this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,a,this)}};FillinNode.prototype.getDataXML=function(a){return FillinNode.prototype.parent.getDataXML(a)};FillinNode.prototype.parseDataXML=function(d){var c=d.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var e=c[a];b.push(FILLINSTATE.prototype.parseDataXML(e))}return b};FillinNode.prototype.parseDataJSONObj=function(a){return FILLINSTATE.prototype.parseDataJSONObj(a)};FillinNode.prototype.exportNode=function(){var a="";a+=this.exportNodeHeader();a+="<jaxbXML><![CDATA[";a+=this.element.getElementsByTagName("jaxbXML")[0].firstChild.nodeValue;a+="]]></jaxbXML>";a+=this.exportNodeFooter();return a};FillinNode.prototype.translateStudentWork=function(a){return a};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/FillinNode.js")}FlashNode.prototype=new Node();FlashNode.prototype.constructor=FlashNode;FlashNode.prototype.parent=Node.prototype;function FlashNode(b,a){this.view=a;this.type=b;this.content=null;this.filename=null;this.audios=[]}FlashNode.prototype.setContent=function(a){this.content=a};FlashNode.prototype.render_old=function(a){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.elementText!=null){this.content=this.elementText}else{if(this.filename!=null){if(window.ActiveXObject){this.content=this.element.xml}else{this.content=(new XMLSerializer()).serializeToString(this.element)}}else{if(this.content==null){this.content=this.element.getElementsByTagName("content")[0].firstChild.nodeValue}}}if(a==null){this.contentPanel=window.frames.ifrm}else{this.contentPanel=window.frames[a.name]}if(this.contentPanel.document){this.writeHTML(this.contentPanel.document)}else{this.writeHTML(window.frames.ifrm.document)}};FlashNode.prototype.writeHTML=function(a){this.replaceVars(a);a.open();a.write(this.content);a.close()};FlashNode.prototype.replaceVars=function(){var g='<param name="movie" value="';var c='"/>';var d=vle.project.contentBaseUrl;if(d){d=d+"/"}else{d=""}var a=this.content.match(/<object.*>(.|\n|\r)*<\/object.*>/i);for(var h=0;h<a.length;h++){if(a[h]&&a[h]!=""&&a[h]!="\n"&&a[h]!="\r"&&a[h]!="\t"&&a[h]!=" "){var j=a[h].indexOf(g)+g.length;var f=a[h].indexOf('"',j);var b=a[h].substring(j,f);var e=new RegExp(b,"g");this.content=this.content.replace(e,d+b)}}};FlashNode.prototype.load=function(){this.createFlashJSInterface();document.getElementById("topStepTitle").innerHTML=this.title};FlashNode.prototype.getDataXML=function(a){return""};FlashNode.prototype.parseDataXML=function(b){var a=new Array();return a};FlashNode.prototype.exportNode=function(){var a="";a+=this.exportNodeHeader();a+="<content><![CDATA[";a+=this.element.getElementsByTagName("content")[0].firstChild.nodeValue;a+="]]></content>";a+=this.exportNodeFooter();return a};FlashNode.prototype.createFlashJSInterface=function(){window.frames.ifrm.showJsAlert=function(){alert("calling js from flash")};window.frames.ifrm.callToFlash=function(a){if(navigator.appName.indexOf("Microsoft")!=-1){window.frames.ifrm.window[a].callToFlash()}else{window.frames.ifrm.document[a].callToFlash()}}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/FlashNode.js")}NoteNode.prototype=new OpenResponseNode();NoteNode.prototype.constructor=NoteNode;NoteNode.prototype.parent=OpenResponseNode.prototype;function NoteNode(b,a){this.view=a;this.type=b;this.prevWorkNodeIds=[]}NoteNode.prototype.renderFrame=function(){if(document["notePanel_"+this.id]==null||document.getElementById("noteiframe"+this.id)==null){var b=createElement(document,"div",{id:"notePanelDiv_"+this.id});var d=createElement(document,"div",{"class":"noteHead"});var a=createElement(document,"div",{"class":"noteBody"});var c=createElement(document,"div",{"class":"noteFooter"});document.getElementById("centeredDiv").appendChild(b);b.appendChild(d);b.appendChild(a);b.appendChild(c);document["notePanel_"+this.id]=new YAHOO.widget.Panel("notePanelDiv_"+this.id,{width:"650px",height:"625px",fixedcenter:false,constraintoviewport:true,underlay:"shadow",y:55,close:true,visible:false,draggable:true});document["notePanel_"+this.id].setHeader("Reflection Note");document["notePanel_"+this.id].setBody('<iframe name="noteiframe'+this.id+'" id="noteiframe'+this.id+'" frameborder="0" width="100%" height="100%" src="node/openresponse/note.html"><iframe>');document["notePanel_"+this.id].cfg.setProperty("underlay","matte");document["notePanel_"+this.id].render()}};NoteNode.prototype.render_old=function(g){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.contentLoaded){var d=function(k,h,j){j.contentPanel.document.open();k=k.replace(/(\.\.\/\.\.\/)/gi,"");j.contentPanel.document.write(j.injectBaseRef(k));j.contentPanel.document.close();if(j.contentPanel.name!="noteiframe"+this.id){j.contentPanel.renderComplete=function(){j.load()}}};var f=vle.state.getNodeVisitsByNodeId(this.id);var b=[];for(var e=0;e<vle.state.visitedNodes.length;e++){var a=vle.state.visitedNodes[e];if(a.getNodeId()==this.id){for(var c=0;c<a.nodeStates.length;c++){b.push(a.nodeStates[c])}}}if(g){this.contentPanel=window.frames[g.name]}else{this.contentPanel=window.frames["noteiframe"+this.id];this.contentPanel.loadContent([this.element,vle,b]);document["notePanel_"+this.id].cfg.setProperty("visible",true);this.insertPreviousWorkIntoPage(this.contentPanel.document);return}vle.connectionManager.request("GET",1,"node/openresponse/note.html",null,d,this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,function(j,h,k){k[0].render(k[1])},[this,g])}};NoteNode.prototype.load=function(){var e=vle.state.getNodeVisitsByNodeId(this.id);var b=[];for(var d=0;d<vle.state.visitedNodes.length;d++){var a=vle.state.visitedNodes[d];if(a.getNodeId()==this.id){for(var c=0;c<a.nodeStates.length;c++){b.push(a.nodeStates[c])}}}this.contentPanel.loadContent([this.element,vle,b]);this.insertPreviousWorkIntoPage(this.contentPanel.document)};NoteNode.prototype.onExit=function(){if(this.contentPanel&&this.contentPanel.save){this.contentPanel.save()}};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/NoteNode.js")}OutsideUrlNode.prototype=new Node();OutsideUrlNode.prototype.constructor=OutsideUrlNode;OutsideUrlNode.prototype.parent=Node.prototype;function OutsideUrlNode(b,a){this.view=a;this.type=b}OutsideUrlNode.prototype.getUrl=function(){return this.content.getContentJSON().url};OutsideUrlNode.prototype.getDataXML=function(a){return OutsideUrlNode.prototype.parent.getDataXML(a)};OutsideUrlNode.prototype.parseDataXML=function(a){return new Array()};OutsideUrlNode.prototype.exportNode=function(){var a="";a+=this.exportNodeHeader();a+="<url>";a+=this.element.getElementsByTagName("url")[0].firstChild.nodeValue;a+="</url>";a+=this.exportNodeFooter();return a};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/OutsideUrlNode.js")}MultipleChoiceNode.prototype=new Node();MultipleChoiceNode.prototype.constructor=MultipleChoiceNode;MultipleChoiceNode.prototype.parent=Node.prototype;function MultipleChoiceNode(b,a){this.view=a;this.type=b;this.mc=null;this.contentBase;this.contentPanel;this.audioSupported=true;this.prevWorkNodeIds=[]}MultipleChoiceNode.prototype.render_old=function(b){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.contentLoaded){var a=function(e,c,d){d.contentPanel.document.open();d.contentPanel.document.write(d.injectBaseRef(injectVleUrl(e)));d.contentPanel.document.close();if(d.contentPanel.name!="ifrm"){d.contentPanel.renderComplete=function(){d.load()}}d.contentPanel.renderLoadComplete=function(){d.onNodefullyloaded()}};if(b){this.contentPanel=window.frames[b.name]}else{this.contentPanel=window.frames.ifrm}vle.connectionManager.request("GET",1,"node/multiplechoice/multiplechoice.html",null,a,this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,function(d,c,e){e[0].render(e[1])},[this,b])}};MultipleChoiceNode.prototype.load=function(){this.contentPanel.loadContent([this.elementText,this,vle]);this.insertPreviousWorkIntoPage(this.contentPanel.document)};MultipleChoiceNode.prototype.renderLite=function(a){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(a){this.liteState=a}var b=function(f,d,e){e.contentPanel.document.open();e.contentPanel.document.write(e.injectBaseRef(injectVleUrl(f)));e.contentPanel.document.close();e.contentPanel.renderComplete=function(){e.loadLite()}};var c={success:function(d){b(d.responseText,d.responseXML,d.argument)},failure:function(d){this.view.notificationManager.notify("failed to retrieve file",3)},argument:this};YAHOO.util.Connect.asyncRequest("GET","node/multiplechoice/multiplechoicelite.html",c,null)};MultipleChoiceNode.prototype.loadLite=function(){this.contentPanel.loadContent([this.element,this,vle,this.liteState])};MultipleChoiceNode.prototype.getDataXML=function(a){return MultipleChoiceNode.prototype.parent.getDataXML(a)};MultipleChoiceNode.prototype.parseDataXML=function(d){var c=d.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var e=c[a];b.push(MCSTATE.prototype.parseDataXML(e))}return b};MultipleChoiceNode.prototype.parseDataJSONObj=function(a){return MCSTATE.prototype.parseDataJSONObj(a)};MultipleChoiceNode.prototype.exportNode=function(){var a="";a+=this.exportNodeHeader();a+="<jaxbXML><![CDATA[";a+=this.element.getElementsByTagName("jaxbXML")[0].firstChild.nodeValue;a+="]]></jaxbXML>";a+=this.exportNodeFooter();return a};MultipleChoiceNode.prototype.getLatestWork=function(a){var b=null;this.mc=new MC(loadXMLString(this.element.getElementsByTagName("jaxbXML")[0].firstChild.nodeValue));this.mc.loadForTicker(this,a);b=this.mc.getLatestState(this.id);if(b==null){return null}return new MultipleChoiceQueryEntry(a.getWorkgroupId(),a.getUserName(),this.id,this.mc.promptText,b.getIdentifier(),this.mc.getCHOICEByIdentifier(b.getIdentifier()).text)};MultipleChoiceNode.prototype.getPrompt=function(){var a=loadXMLString(this.getXMLString());this.mc=new MC(a);return this.mc.promptText};MultipleChoiceNode.prototype.makeQueryContainer=function(a){this.mc=new MC(loadXMLString(this.element.getElementsByTagName("jaxbXML")[0].firstChild.nodeValue));this.mc.loadForTicker(this,a);return new MultipleChoiceQueryContainer(this.id,this.mc.promptText,this.mc.choiceToValueArray)};MultipleChoiceNode.prototype.translateStudentWork=function(a){this.mc=new MC(loadXMLString(this.getXMLString()));return this.mc.getCHOICEByIdentifier(a).text};MultipleChoiceNode.prototype.parseStateXML=function(a){return MCSTATE.prototype.parseDataXML(a)};MultipleChoiceNode.prototype.onExit=function(){};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/MultipleChoiceNode.js")}BrainstormNode.prototype=new Node();BrainstormNode.prototype.constructor=BrainstormNode;BrainstormNode.prototype.parent=Node.prototype;function BrainstormNode(b,a){this.view=a;this.type=b;this.audioSupported=true;this.serverless=true;this.prevWorkNodeIds=[]}BrainstormNode.prototype.isUsingServer=function(){if(this.content.getContentJSON().useServer){this.serverless=false;return true}else{this.serverless=true;return false}};BrainstormNode.prototype.getDataXML=function(a){return BrainstormNode.prototype.parent.getDataXML(a)};BrainstormNode.prototype.parseDataXML=function(e){var c=e.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var f=c[a];var d=BRAINSTORMSTATE.prototype.parseDataXML(f);if(d!=null){b.push(d)}}return b};BrainstormNode.prototype.parseDataJSONObj=function(a){return BRAINSTORMSTATE.prototype.parseDataJSONObj(a)};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/BrainstormNode.js")}GlueNode.prototype=new Node();GlueNode.prototype.constructor=GlueNode;GlueNode.prototype.parent=Node.prototype;function GlueNode(b,a){this.view=a;this.type=b}GlueNode.prototype.renderPrev=function(){this.contentPanel.renderPrev()};GlueNode.prototype.renderNext=function(){this.contentPanel.renderNext()};GlueNode.prototype.getDataXML=function(a){return GlueNode.prototype.parent.getDataXML(a)};GlueNode.prototype.parseDataXML=function(e){var c=e.getElementsByTagName("state");var b=new Array();for(var a=0;a<c.length;a++){var f=c[a];var d=GLUESTATE.prototype.parseDataXML(f);if(d!=null){b.push(d)}}return b};GlueNode.prototype.parseDataJSONObj=function(a){return GLUESTATE.prototype.parseDataJSONObj(a)};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/GlueNode.js")}DataGraphNode.prototype=new Node();DataGraphNode.prototype.constructor=DataGraphNode;DataGraphNode.prototype.parent=Node.prototype;function DataGraphNode(b,a){this.view=a;this.type=b;this.contentPanel;this.prevWorkNodeIds=[]}DataGraphNode.prototype.render_old=function(b){if(this.filename!=null&&vle.project.lazyLoading&&(!this.contentLoaded)){this.retrieveFile()}if(this.contentLoaded){var a=function(e,c,d){d.contentPanel.document.open();d.contentPanel.document.write(d.injectBaseRef(injectVleUrl(e)));d.contentPanel.document.close();if(d.contentPanel.name!="ifrm"){d.contentPanel.renderComplete=function(){d.load()}}d.contentPanel.renderLoadComplete=function(){d.onNodefullyloaded()}};if(b){this.contentPanel=window.frames[b.name]}else{this.contentPanel=window.frames.ifrm}vle.connectionManager.request("GET",1,"node/datagraph/datagraph.html",null,a,this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,function(d,c,e){e[0].render(e[1])},[this,b])}};DataGraphNode.prototype.load=function(){var a=function(f,c,e){if(!e){e=f}var g;for(var d=0;d<vle.state.visitedNodes.length;d++){var b=vle.state.visitedNodes[d];if(b.getNodeId()==e.id){if(b.nodeStates.length>0){g=b.nodeStates[b.nodeStates.length-1]}}}e.contentPanel.loadContent([e.element,vle,g]);e.insertPreviousWorkIntoPage(e.contentPanel.document)};if(this.contentLoaded){a(this)}else{vle.eventManager.subscribe("nodeLoadingContentComplete_"+this.id,a,this)}};DataGraphNode.prototype.getDataXML=function(a){return DataGraphNode.prototype.parent.getDataXML(a)};DataGraphNode.prototype.parseDataXML=function(a){};DataGraphNode.prototype.parseDataJSONObj=function(a){};DataGraphNode.prototype.exportNode=function(){};DataGraphNode.prototype.translateStudentWork=function(a){return a};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/DataGraphNode.js")}SVGDrawNode.prototype=new HtmlNode();SVGDrawNode.prototype.constructor=SVGDrawNode;SVGDrawNode.prototype.parent=HtmlNode.prototype;function SVGDrawNode(b,a){this.view=a;this.type=b;this.content=null;this.filename=null;this.audios=[];this.contentBase;this.audioSupported=true}SVGDrawNode.prototype.updateJSONContentPath=function(b){var a=new RegExp(this.filename);this.content.replace(a,b+"/"+this.filename)};if(typeof eventManager!="undefined"){eventManager.fire("scriptLoaded","vle/node/SVGDrawNode.js")};if(typeof eventManager != "undefined"){eventManager.fire("scriptLoaded", "vle/all/summary_all-min.js");};