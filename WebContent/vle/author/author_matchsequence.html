<!-- @author: patrick lawler -->
<html>
<head>

<!-- Dependency --> 
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/yahoo/yahoo-min.js" ></script>

<!-- Event source file -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/event/event-min.js" ></script>

<!-- Sam Skin CSS -->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.7.0/build/container/assets/skins/sam/container.css">

<!-- Dependencies -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"></script>

<!-- OPTIONAL: Animation (only required if using ContainerEffect) -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/animation/animation-min.js"></script>

<!-- OPTIONAL: Drag & Drop (only required if enabling Drag & Drop) -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/dragdrop/dragdrop-min.js"></script>

<!-- Source file -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/container/container-min.js"></script>

<!-- Connection manager -->
<script src="http://yui.yahooapis.com/2.7.0/build/connection/connection-min.js"></script>

<script type="text/javascript" src="../js/common/loadxmldoc.js"></script>
<script type="text/javascript" src="../js/node/common/js/loadxmldoc.js"></script>
<script type="text/javascript" src="../js/common/helperfunctions.js"></script>
<script type="text/javascript" src="../js/node/Node.js"></script>
<script type="text/javascript" src="../js/authoring/author_helper.js"></script>
<script type="text/javascript" src="../js/authoring/author_advanced_helper.js"></script>

<script type="text/javascript">
var saved = true;

/**
 * Load the authoring view from the specified filename
 * filename points to a plain old file.
 */
function loadAuthoringFromFile(filename, projectName, projectDir) {
	var callback =
	{
	  success: function(o) { 
		var xmlDoc=loadXMLDocFromString(o.responseText);
		
		/*
		 * display the xmlString to the user in the left area so they can
		 * edit and author it. 
		 */
		document.getElementById('sourceTextArea').value = o.responseText;
	
		//retrieve the xmlString from the mcObj
		var xmlString = "";
		var customCheck = "";
		if(window.ActiveXObject) {
			xmlString = xmlDoc.getElementsByTagName('assessmentItem')[0].xml;
			if(xmlDoc.getElementsByTagName('customCheck')[0]!=null){
				customCheck = xmlDoc.getElementsByTagName('customCheck')[0].firstChild.nodeValue;
			};
		} else {
			xmlString = (new XMLSerializer()).serializeToString(xmlDoc.getElementsByTagName('assessmentItem')[0]);
			if(xmlDoc.getElementsByTagName('customCheck')[0]!=null){
				customCheck = xmlDoc.getElementsByTagName('customCheck')[0].firstChild.nodeValue;
			};
		}

		if(customCheck != null && customCheck != ""){
			window.frames["previewFrame"].loadFromXMLString(xmlString, customCheck);
		} else {
			window.frames["previewFrame"].loadFromXMLString(xmlString);
		};

		  },
		  failure: function(o) { alert('failure');},
		  scope:this
	}

	YAHOO.util.Connect.asyncRequest('POST', '../../filemanager.html', callback, 'command=retrieveFile&param1=' + projectName + '&param2=' + filename + '&projectDir=' + projectDir);
}

/*
 * Called when 'keyup' event is received on sourceTextArea on this page.
 * gets the text in the textarea and re-renders the previewFrame
 */
function sourceUpdated() {
	saved = false;
	var xmlString = "";
	var customCheck = "";
	var xmlDoc=loadXMLDocFromString(document.getElementById('sourceTextArea').value);

		if(window.ActiveXObject) {
			xmlString = xmlDoc.getElementsByTagName('assessmentItem')[0].xml;
			if(xmlDoc.getElementsByTagName('customCheck')[0]!=null){
				customCheck = xmlDoc.getElementsByTagName('customCheck')[0].firstChild.nodeValue;
			};
		} else {
			xmlString = (new XMLSerializer()).serializeToString(xmlDoc.getElementsByTagName('assessmentItem')[0]);
			if(xmlDoc.getElementsByTagName('customCheck')[0]!=null){
				customCheck = xmlDoc.getElementsByTagName('customCheck')[0].firstChild.nodeValue;
			};
		}

		if(customCheck != null && customCheck != ""){
			window.frames["previewFrame"].loadFromXMLString(xmlString, customCheck);
		} else {
			window.frames["previewFrame"].loadFromXMLString(xmlString);
		};
		
	//window.frames["previewFrame"].loadXMLString(xmlString);
}
</script>
</head>
<body onload="loaded()">
<table border='1' bgcolor='white' style='width:100%;height:100%'>
	<tr>
   		<td width='50%'><textarea id='sourceTextArea' style='width:100%;height:100%' onkeyup='sourceUpdated();'></textarea></td>
   		<td width='50%'><iframe id='previewFrame' width='100%' height='100%' name='previewFrame' src='../js/node/matchsequence/matchsequence.html'></iframe></td>
	</tr>
</table>
<!--  for posting the text for echo servlet -->
<form name="saveLocal" id='saveLocal' action="../../echo.html" method="POST">
    <input type="hidden" name="name" id="form_filename" value="myData"/>
    <input type="hidden" name="data" id="localData" value=""/>
</form>
</body>
</html>