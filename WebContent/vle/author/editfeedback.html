<!-- @author: patrick lawler -->
<html>
	<head>
		<script type="text/javascript" src="../util/scriptloader.js"></script>
		<script type="text/javascript">
			var mainPage;
			var parentPage;
			var choice;
			var container;
			
			function loadScripts(){
				scriptloader.initialize(document, loaded, 'feedback');
			};
			
			function loaded(){
				parentPage = window.opener;
				mainPage = window.opener.mainPage;
				choice = window.opener.currentChoice;
				container = window.opener.currentContainer;
				
				var feedbackInput = document.getElementById('feedbackInput');
				var feedback = mainPage.getValueByChoiceAndFieldIdentifiers(choice, container);
				
				if(feedback && feedback.firstChild){
					feedbackInput.value = feedback.firstChild.nodeValue;
				};
			};
			
			function updateFeedback(){
				var feedbackInput = document.getElementById('feedbackInput');
				var feedback = mainPage.getValueByChoiceAndFieldIdentifiers(choice, container);
			 	
			 	if(!feedback){
			 		mainPage.createNewFeedback(choice, container);
			 		feedback = mainPage.getValueByChoiceAndFieldIdentifiers(choice, container);
			 	};
			 	mainPage.updateFeedback(choice, container, feedbackInput.value);
			 	
			 	parentPage.generateTable();
			};
		</script>

	</head>
	<body onload='loadScripts()'>
		<div>
			Enter/Edit Feedback: <br>
			<textarea id='feedbackInput' type='text' cols='85' rows='10'onchange='updateFeedback()'></textarea><br>
			<input id="doneButton" type='button' value='Done' onclick='self.close()'/>
		</div>
	</body>
</html>