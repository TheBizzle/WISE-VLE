<!-- @author: patrick lawler -->

<html>
<head>

<script type="text/javascript" src="../util/scriptloader.js"></script>

<script type="text/javascript">
var filename;
var easyMode;
var rootPageName;
var childSave;
var projectName;
var projectPath;
var pathSeparator;
var getSaved;
var project;
var iconPath;
var connectionManager;

/**
 * Removes previous, creates a new frame, determines the 
 * correct page based on variables and sets that as the
 * frame source and appends new frame to page
 */
function changeFramed(){
	if(getSaved){
		if(!getSaved() && childSave){
			childSave();
		};
	};
	
	var parent = document.getElementById('frameDiv');
	var old = document.getElementById('authorFrame');
	
	if(old){
		parent.removeChild(old);
	};
	
	var page = rootPageName;
	if(easyMode){
		page += '_easy.html';
	} else {
		page += '.html';
	};
	
	var authorFrame = createElement(document, 'iframe', {name: 'authorFrame', id: 'authorFrame', width: '100%', height: '95%', frameborder: '0', src: page});
	
	parent.appendChild(authorFrame);
};

/**
 * Toggles value of easyMode and calls changeFramed() when option clicked
 */
function modeChanged(val){
	if(val==true || val=='true'){
		easyMode = true;
	} else {
		easyMode = false;
	};
	changeFramed();
};

/**
 * function given to parent window so that we can set certain
 * critical variables here
 */
function setVars(fn, m, pn, prn, pp, pr, ps, ip, cm){
	filename = fn;
	easyMode = m;
	rootPageName = pn;
	projectName = prn;
	projectPath = pp;
	project = pr;
	pathSeparator = ps;
	iconPath = ip;
	connectionManager = cm;
	
	if(easyMode){
		document.getElementById('easyTrue').checked = true;
	} else {
		document.getElementById('easyFalse').checked = true;
	};
	document.getElementById('iconDiv').innerHTML = iconPath;
};

/**
 * calls function from parent with local function to get vars from
 * parent and then calls changeFramed() to create new frame with 
 * correct authoring page
 */
function afterScriptsLoaded(){
	if(window.opener){
		window.opener.authoringWindowLoaded(setVars);
		changeFramed();
	};
};

function loaded(){
	scriptloader.initialize(document, afterScriptsLoaded, 'author_framed');
};

function save(){
	childSave();
};

window.onbeforeunload = function(){
	childSave();
};
</script>
</head>
<body onload='loaded()'>
	<div id='main'>
		<div id='header'>
			<table>
				<tr>
					<td id='iconTD'><div id='iconDiv'></div></td>
					<td>
						Editor View:
						<input type='radio' id='easyTrue' name='radioMode' onclick='modeChanged(true)'>Simple</input>
						<input type='radio' id='easyFalse' name='radioMode' onclick='modeChanged(false)'/>Advanced</input>
					</td>
					<td id="authorNavButtons">
						<input type='button' value='Save' onclick='save()'/>
						<input type='button' value='Save & Close' onclick='self.close()'/>
					</td>
				</tr>
			</table>
		</div>
		<div id='frameDiv'>
			<iframe id='authorFrame' name='authorFrame' width='100%' height='90%'></iframe>
		</div>
	</div>
</body>
</html>