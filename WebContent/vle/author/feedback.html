<!-- @author: patrick lawler -->
<html>
	<head>
		
	<!-- AUTHOR CSS -->
	<link rel="stylesheet" type="text/css" href="../css/authoring/authoring.css">

		<script type="text/javascript" src="../common/helperfunctions.js"></script>
		<script type="text/javascript">
			var mainPage = window.opener;
			var currentContainer = null;
			var currentChoice = null;
			
			window.onbeforeunload=function(){
				mainPage.updatePreview();
			};
			
			/**
			 * Generates this page
			 */
			function generatePage(){
				var parent = document.getElementById('mainDiv');
				var instructions = document.createTextNode('Click any colored field to add/edit its text. Click "Done" when finished.');
				
				parent.appendChild(instructions);
				parent.appendChild(createBreak());
				parent.appendChild(createBreak());
				
				generateTable();
			};
			
			/**
			 * Generates a table of choices vs. containters which will allow for editing
			 * creating feedback that choice in that container
			 */
			 function generateTable(){
			 	var parent = document.getElementById('mainDiv');
			 	var old = document.getElementById('containerChoiceTable');
			 	var oldButton = document.getElementById('doneButton');
			 	
			 	//wipe out old
			 	if(old){
			 		parent.removeChild(old);
			 		parent.removeChild(oldButton);
			 	};
			 	
			 	//create new
				var choices = mainPage.getChoices();
				var containers = mainPage.getGapMultiples();
			 	var table = createElement(document, 'table', {id: 'containerChoiceTable'});
			 	var headerRow = createElement(document, 'tr', {id: 'headerRow'});
			 	var headerLabel = createElement(document, 'td', {id: 'headerLabel'});
			 	var containerLabelDiv = createElement(document, 'div', {id: 'containerLabelDiv', align: 'right'});
			 	var choiceLabelDiv = createElement(document, 'div', {id: 'choiceLabelDiv'});
				var doneButton = createElement(document, 'input', {id: 'doneButton', type: 'button', value: 'Done', onclick: 'self.close()'});
							 	
			 	containerLabelDiv.innerHTML = 'Containers:';
			 	choiceLabelDiv.innerHTML = 'Choices';
			 	
			 	headerLabel.appendChild(containerLabelDiv);
			 	headerLabel.appendChild(choiceLabelDiv);
			 	headerRow.appendChild(headerLabel);
			 	for(var a=0;a<containers.length;a++){
			 		var containerName = createElement(document, 'td', {id: 'containerName_' + containers[a].getAttribute('identifier')});
			 		containerName.innerHTML = containers[a].firstChild.nodeValue;
			 		headerRow.appendChild(containerName);
			 	};
			 	
			 	table.appendChild(headerRow);
			 	
			 	for(var b=0;b<choices.length;b++){
			 		var row = createElement(document, 'tr', {id: 'row_' + b});
			 		var choiceLabelTD = createElement(document, 'td', {id: 'choiceLabelTD_' + b});
			 		
			 		choiceLabelTD.innerHTML = choices[b].firstChild.nodeValue;
			 		row.appendChild(choiceLabelTD);
			 		for(var c=0;c<containers.length;c++){
			 			var choiceId = choices[b].getAttribute('identifier');
			 			var containerId = containers[c].getAttribute('identifier');
			 			var val = mainPage.getValueByChoiceAndFieldIdentifiers(choiceId, containerId);
			 			var feedbackTD = createElement(document, 'td', {id: 'cell_' + b + '_' + c, onclick: 'editFeedback("' + choiceId + '","' + containerId + '")'});
			 			
			 			if(val){ //feedback exists
			 				var html;
			 				if(val.getAttribute('isCorrect')=='true'){
			 					feedbackTD.setAttribute('bgcolor', '#99FFCC');
			 					html = val.firstChild.nodeValue;
			 				} else {
			 					feedbackTD.setAttribute('bgcolor', '#FF9999');
			 					html = val.firstChild.nodeValue;
			 				};
			 				feedbackTD.innerHTML = html;
			 			} else { //feedback not there
			 				feedbackTD.setAttribute('bgcolor', '#FF9999');
			 				feedbackTD.innerHTML = 'Create Feedback';
			 			};
			 			
			 			row.appendChild(feedbackTD);
			 		};
			 		
			 		table.appendChild(row);
			 	};
			 	
			 	parent.appendChild(table);
			 	parent.appendChild(doneButton);
			 };
			 
			 /** 
			  * Sets the currentChoice and currentContainer vars and opens
			  * a popup in which to edit the feedback
			  */
			function editFeedback(choiceId, containerId){
			 	currentChoice = choiceId;
			 	currentContainer = containerId;
			 	window.open('editfeedback.html', '', 'resizable=1,width=750,height=275');
			 };
			 
			/**
			 * returns a <br> element
			 */
			function createBreak(){
				return createElement(document, 'br', null);
			};
		</script>
	</head>
	
	<body onload="generatePage()">
		<div id='mainDiv'>
		</div>
	</body>
</html>