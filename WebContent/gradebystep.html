<html>
<head>
<title>Grade By Step</title>
<script type="text/javascript" src="vle/util/scriptloader.js"></script>
<script type='text/javascript' src='vle/yui/yui_3.0.0b1/build/yui/yui-min.js'></script>

<link rel="stylesheet" type="text/css" href="vle/css/portal/teachergrading.css" />

<script type="text/javascript">
var studentWorkQueryObject;

/**
 * Called after all the js files are loaded
 */
function afterScriptsLoad(){
	//after all the js files have been loaded, render the gradebystep display
	render(contentUrl, userUrl, getDataUrl, contentBaseUrl, getAnnotationsUrl, postAnnotationsUrl, runId);
}

/**
 * Called when the page starts to load
 */
window.onload=function(){
	//load all the js files
	scriptloader.initialize(document, afterScriptsLoad, 'main');
}

function projectSummary(){
	window.open("/webapp/student/vle/vle.html?runId=" + runId + "&summary=true", "Project Summary", "height=600, width=800");
};
</script>

<!--  Javascript Pop up window -->

<script type="text/javascript">
var contentUrl;
var userUrl;
var getDataUrl;
var teacherId;
var studentWorkgroupIds;
var vleStates;
var getAnnotationsUrl;
var postAnnotationsUrl;
var annotations;
var contentBaseUrl;
var getFlagsUrl;
var postFlagsUrl;
var flags;

var runId = null;
var newWin = null;
function popUp(strURL, strType, strHeight, strWidth) {
 if (newWin != null && !newWin.closed)
   newWin.close();
 var strOptions="";
 if (strType=="console")
   strOptions="resizable,height="+
     strHeight+",width="+strWidth;
 if (strType=="fixed")
   strOptions="status,height="+
     strHeight+",width="+strWidth;
 if (strType=="elastic")
   strOptions="toolbar,menubar,scrollbars,"+
     "resizable,location,height="+
     strHeight+",width="+strWidth;
 newWin = window.open(strURL, 'newWin', strOptions);
 newWin.focus();
}

/**
 * This gets called by gradebystep.jsp in the topiframeOnLoad() function.
 * We will just remember all the url arguments to use them later when
 * in afterScriptsLoad() when we call render().
 */
function load(contentUrl, userUrl, getDataUrl, contentBaseUrl, getAnnotationsUrl, postAnnotationsUrl, runId, getFlagsUrl, postFlagsUrl) {
	//alert("contentURL: " + contentUrl + "\n\nuserURL: " + userUrl + "\n\ngetDataUrl: " + getDataUrl + "\n\ncontentBaseUrl: " + contentBaseUrl + "\n\ngetAnnotationsUrl: " + getAnnotationsUrl + "\n\npostAnnotationsUrl: " + postAnnotationsUrl);
	this.contentUrl = contentUrl;
	this.userUrl = userUrl;
	this.getDataUrl = getDataUrl;
	this.contentBaseUrl = contentBaseUrl;
	this.getAnnotationsUrl = getAnnotationsUrl;
	this.postAnnotationsUrl = postAnnotationsUrl; 
	this.runId = runId;
	this.getFlagsUrl = getFlagsUrl;
	this.postFlagsUrl = postFlagsUrl;
}

/**
 * Posts the new or updated annotation back to the server and if that was 
 * successful, it will create a local Annotation object and place it in
 * our array of Annotations so our local copy is up to date
 */
function saveAnnotation(nodeId, toWorkgroup, fromWorkgroup, type, value, runId) {
	//alert("nodeId: " + nodeId + "\ntoWorkgroup: " + toWorkgroup + "\nfromWorkgroup: " + fromWorkgroup + "\ntype: " + type + "\nvalue: " + value);

	//build the post annotation url with get arguments
	var postAnnotationURL = postAnnotationsUrl + "?runId=" + runId + "&nodeId=" + nodeId + "&toWorkgroup=" + toWorkgroup + "&fromWorkgroup=" + fromWorkgroup + "&type=" + type + "&value=" + value;
	
	var postAnnotationCallback =
	{
		success: function(o) {
			/*
			 * if the post was successful it will be returned back to us
			 * and we will then create a local Annotation object so that
			 * our local array is up to date
			 */
			var annotation = Annotation.prototype.parseDataXML(o.responseXML);
			annotations.addAnnotation(annotation);
		},
		failure: function(o) {
			alert('Error: Unable to load user info');
		},
		argument: ["a", "b", "c"],
		scope:this
	};

	//make the call to post the annotation
	var getUserTransaction = YAHOO.util.Connect.asyncRequest('GET', postAnnotationURL, postAnnotationCallback, null);
}

/**
 * Posts the flag to the server and if it was successful, we will update our
 * local copy of the flags
 * @param nodeId the id of the node
 * @param toWorkgroup id of the student
 * @param fromWorkgroup id of the teacher
 * @param studentWork the student's work
 * @param runId the id of the run
 * @param deleteFlag boolean whether to delete the flag or not
 * @param itemNumber the index of the item in the flaggedItemTable
 */
function saveFlag(nodeId, toWorkgroup, fromWorkgroup, studentWork, runId, deleteFlag, itemNumber) {
	//alert("nodeId: " + nodeId + "\ntoWorkgroup: " + toWorkgroup + "\nfromWorkgroup: " + fromWorkgroup + "\ntype: " + type + "\nvalue: " + value);
	
	//build the post flag url with get arguments
	var postFlagUrl = postFlagsUrl + "?runId=" + runId + "&nodeId=" + nodeId + "&toWorkgroup=" + toWorkgroup + "&fromWorkgroup=" + fromWorkgroup + "&studentWork=" + studentWork;

	//check if we are flagging or unflagging the flag
	if(deleteFlag == true) {
		//add the action of unflag if we are unflagging
		postFlagUrl += "&action=unflag";

		//remove the row from the flagged items table
		removeFlaggedItemFromDisplay(itemNumber);
	} else {
		//add the row to the flagged items table
		addFlaggedItemToDisplay(nodeId, toWorkgroup, fromWorkgroup, studentWork, runId, itemNumber);
	}

	var postFlagCallback =
	{
		success: function(o) {
			
			if(deleteFlag == true) {
				//if we are unflagging, remove the flag from our local array
				flags.removeFlag(runId + '', nodeId, toWorkgroup + '', fromWorkgroup + '', studentWork);
			} else {
				/*
				 * if the post was successful it will be returned back to us
				 * and we will then create a local Flag object so that
				 * our local array is up to date
				 */
				var flag = Flag.prototype.parseDataXML(o.responseXML);
				flags.addFlag(flag);
			}
		},
		failure: function(o) {
			alert('Error: Unable to load user info');
		},
		argument: ["a", "b", "c"],
		scope:this
	};

	//make the call to post the annotation
	var getUserTransaction = YAHOO.util.Connect.asyncRequest('GET', postFlagUrl, postFlagCallback, null);
}

</script>

</head>

<body class=" yui-skin-sam">

<div id="gradeByStepDiv"></div>

<script type="text/javascript">

function expandMenu(menuId) {
	myMenu.expandMenu(document.getElementById(menuId));
}

/**
 * Setup and display the project
 *
 * @param contentURL a url to the project file, we will use a get
 *		request to obtain the project file
 * @param userURL a url to the user info, we will use a get request
 *		to obtain the user info 
 */
function render(contentURL, userURL, getDataUrl, contentBaseUrl, getAnnotationsUrl, postAnnotationsUrl, runId, getFlagsUrl, postFlagsUrl) {
	vle = new VLE();

	//load the project content
	vle.loadProject(contentUrl, contentBaseUrl);

	//retrieve the workgroup ids for the students
	getStudentUserInfo();

	//setup events
	vle.eventManager.addEvent(vle, 'getStudentUserInfoComplete');
	vle.eventManager.addEvent(vle, 'getStudentWorkComplete');
	vle.eventManager.addEvent(vle, 'getAnnotationsComplete');

	/*
	 * when we are done retrieving the student workgroup ids, we will
	 * retrieve the work from all the students
	 */
	vle.eventManager.subscribe("getStudentUserInfoComplete", getStudentWork);

	/*
	 * when we are done retrieving the student work, we will retrieve
	 * the annotations
	 */
	vle.eventManager.subscribe("getStudentWorkComplete", getAnnotations);

	vle.eventManager.subscribe("getAnnotationsComplete", getFlags);
}

/**
 * Retrieve the student workgroupIds
 */
function getStudentUserInfo() {
	var studentWorkCallback = {
			success: function(o) {
				//parse and load the xml that contains the workgroup ids
				vle.loadUserAndClassInfo(o.responseXML);

				//get the teacher workgroup id
				teacherId = vle.getWorkgroupId();

				//retrieve all the student users
				studentWorkgroupIds = new Array();
				classUsers = vle.getClassUsers();

				//loop through all the classmates
				for(var x=0; x<classUsers.length; x++) {
					//all users including the teacher are stored as a classmate right now
					if(classUsers[x].workgroupId != teacherId) {
						/*
						 * if the user is not the teacher, add it to the 
						 * student workgroup ids array
						 */
						studentWorkgroupIds.push(classUsers[x].workgroupId);
					}
				}

				//fire this event to notify others that we are done getting the student workgroup ids
				vle.eventManager.fire("getStudentUserInfoComplete");
			},
			failure: function(o) {
				alert("Failed to load student work");
			},
			argument: ["a", "b", "c"],
			scope:this
	};
	YAHOO.util.Connect.asyncRequest('GET', userUrl, studentWorkCallback);
		
}

/**
 * This should only be called after getStudentUserInfo() has been called.
 * This just appends all the student workgroup ids together seperated by :
 * e.g.
 * 139:143:152
 * @return a string containing the student workgroup ids delimited by :
 */
function getStudentWorkgoupIds() {
	var ids = "";

	//loop through all the student workgroup ids
	for(var x=0; x<studentWorkgroupIds.length; x++) {
		if(ids != "") {
			/*
			 * if this is not the first workgroup id, we need to seperate
			 * it from the previous id with a :
			 */
			ids += ":";
		}
		ids += studentWorkgroupIds[x];
	}
	return ids;
}

/**
 * Retrieve the student work from the db
 */
function getStudentWork() {
	var getStudentDataUrl = getDataUrl + "?userId=" + getStudentWorkgoupIds();
	var studentWorkCallback = {
			success: function(o) {
				var xmlObject = o.responseXML;

				//parse all the vlestates for all the students
				vleStates = VLE_STATE.prototype.parseVLEStatesDataXMLObject(xmlObject);

				/*
				 * display links for all the steps so the user can click on a
				 * link and see everyone's work for that step
				 */
				displaySteps();

				//fire the event to nofity others that we are done getting the student work
				vle.eventManager.fire("getStudentWorkComplete");
			},
			failure: function(o) {
				alert("Failed to load student work");
			},
			argument: ["a", "b", "c"],
			scope:this
	};
	YAHOO.util.Connect.asyncRequest('GET', getStudentDataUrl, studentWorkCallback);
}

/**
 * Retrieve all the annotations for this run
 */
function getAnnotations() {
	var annotationCallback = {
			success: function(o) {
				//parse the xml annotations object that contains all the annotations
				annotations = Annotations.prototype.parseDataXML(o.responseXML);
				vle.eventManager.fire("getAnnotationsComplete");
		  	},
			failure: function(o) {
				alert('Error: Unable to load user info');
			},
			argument: ["a", "b", "c"],
			scope:this
	};
	var getUserTransaction = YAHOO.util.Connect.asyncRequest('GET', getAnnotationsUrl, annotationCallback, null);
}

/**
 * Retrieve all the flags for this run
 */
function getFlags() {
	var flagCallback = {
			success: function(o) {
				//parse the xml flags object that contains all the flags
				flags = Flags.prototype.parseDataXML(o.responseXML);
		  	},
			failure: function(o) {
				alert('Error: Unable to load user info');
			},
			argument: ["a", "b", "c"],
			scope:this
	};
	var getUserTransaction = YAHOO.util.Connect.asyncRequest('GET', getFlagsUrl, flagCallback, null);

}

/**
 * Displays all the steps in the project as links. When a step is clicked on,
 * the user will be brought to a page that displays all the work for that
 * step from all students in the run.
 */
function displaySteps() {
	var displayStepsHtml = "";

	//start the table that will contains links for the steps
	displayStepsHtml += "<table class='chooseStepToGradeTable'><tbody>";

	//add the refresh button at the top of the page
	displayStepsHtml += "<tr><td><input type='button' value='Refresh' onClick='refresh()'></input></td></tr>";
	
	/*
	 * get the html that displays all the steps for the project as links
	 * to pages where the teacher can grade the step
	 */
	displayStepsHtml += displayStepsHelper(vle.project.rootNode);

	//add the refresh button at the top of the page
	document.getElementById('gradeByStepDiv').innerHTML = "<input type='button' value='Refresh All Steps' onClick='refresh()'><br>";
	//close the table
	displayStepsHtml += "</tbody></table>";

	//set the html into the div
	document.getElementById('gradeByStepDiv').innerHTML = displayStepsHtml;
}

/**
 * Recrusive function that accumulates the html that displays all the activites
 * and steps in a project
 */
function displayStepsHelper(node) {
	var displayStepsHtml = "";
	
	if(node.isLeafNode()) {
		//this node is a leaf/step
		if(node.type != "HtmlNode") {
			/*
			 * this leaf/step is not an html page which should mean it's
			 * a step the student needs to submit work for. we will
			 * display a link for this step. in the future there should
			 * be a function node.containsStudentWork() or something.
			 */
			displayStepsHtml += "<a href='#' onClick='getGradeByStepHtml(\"" + node.id + "\")'>" + node.title + " [" + node.type + "]</a>";			
			displayStepsHtml += "<tr><td><a href='#' onClick='getGradeByStepHtml(\"" + node.id + "\")'>" + node.title + " [" + node.type + "]</a></td></tr>";			
		}
	} else {
		//this node is a sequence so we will display the title
		displayStepsHtml += "<tr><td><h4>" + node.title + "</h4></td></tr>";

		//loop through all its children
		for(var x=0; x<node.children.length; x++) {
			//get the html for the children
			displayStepsHtml += displayStepsHelper(node.children[x]);
		}
	}

	return displayStepsHtml;
}

/**
 * Displays the grading view for a step which includes all the student ids,
 * student work, and grading text box
 * @param nodeId the step to display the grading view for
 */
function getGradeByStepHtml(nodeId) {
	var gradeByStepHtml = "";

	/*
	 * add the button that allows the user to get back to the screen to choose
	 * the step
	 */
	gradeByStepHtml += "<input type='button' value='Go Back to Steps' onClick='displaySteps()'>";
	gradeByStepHtml += "<div id='flaggedItems'></div>";

	var getFlagCallback = {
			success: function(o) {
				var flags = Flags.prototype.parseDataXML(o.responseXML);
				
				//create the html that will display the flagged items
				var flagTableHtml = "";
				flagTableHtml += "<table border='1' id='flaggedItemsTable' class='flaggedItemsTable'>";
				flagTableHtml += "<tr><th>Flagged Responses</th></tr>";
				
				if(flags.flagsArray.length == 0) {
					//nofity the user if there were no flagged items
					flagTableHtml += "<tr id='noFlaggedResponses'><td>No flagged responses</td></tr>";
				} else {
					//loop through all the flagged items
					for(var x=0; x<flags.flagsArray.length; x++) {
						//display the student work that has been flagged
						flagTableHtml += "<tr id='flaggedItem" + x + "'><td>" + flags.flagsArray[x].studentWork + "</td>";

						//add the button to unflag the particular student work						
						flagTableHtml += "<td><input type='button' value='Unflag Work' onClick='saveFlag(\"" + flags.flagsArray[x].nodeId + "\", " + flags.flagsArray[x].toWorkgroup + ", " + flags.flagsArray[x].fromWorkgroup + ", \"" + flags.flagsArray[x].studentWork + "\", " + runId + ", true," + x + ")'></td>";
						flagTableHtml += "</tr>";
					}
				}
				
				flagTableHtml += "</table>";

				//set the html into the div
				document.getElementById('flaggedItems').innerHTML = flagTableHtml;
			},
			failure: function(o) {

			},
			argument: ["a", "b", "c"],
			scope:this
	};

	var getFlagsTransaction = YAHOO.util.Connect.asyncRequest('GET', getFlagsUrl + "&nodeId=" + nodeId, getFlagCallback, null);
	
	//create the table that displays all the student data, student work, and grading text box
	gradeByStepHtml += "<table border='1' class='studentWorkTable'>";

	//add the header for the table
	gradeByStepHtml += "<tr><th>Workgroup Id</th><th>Work</th><th>Grading</th><th>Save Annotation</th><th>Flag</th></tr>";

	//loop through all the vleStates, each vleState is for a workgroup
	for(var x=0; x<vleStates.length; x++) {
		//get a vleState
		var vleState = vleStates[x];

		//get the latest work for the current workgroup 
		var studentWork = vleState.getLatestWorkByNodeId(nodeId);

		//obtain the annotation for this workgroup and step if any
		var annotation = annotations.getLatestAnnotation(runId, nodeId, vleState.dataId, teacherId, "comment");

		gradeByStepHtml += "<tr>";

		//display the student workgroup id
		gradeByStepHtml += "<td>" + vleState.dataId + "</td>";

		//display the student work for this step/node
		gradeByStepHtml += "<td>" + studentWork + "</td>";

		/*
		 * display the grading text box and save annotation button
		 */
		if(annotation != null) {
			//the annotation exists so we will populate the values from the annotation
			gradeByStepHtml += "<td><textarea rows='10' cols='10' id='annotationTextArea" + vleState.dataId + "'>" + annotation.value + "</textarea></td>";

			//add the save annotation button that will save the annotation to the db when clicked
			gradeByStepHtml += "<td><input type='button' name='submitAnnotation" + vleState.dataId + "' value='Save Annotation' onClick='saveAnnotation(\"" + nodeId + "\", \"" + annotation.toWorkgroup + "\", \"" + annotation.fromWorkgroup + "\", \"" + annotation.type + "\", document.getElementById(\"annotationTextArea" + vleState.dataId + "\").value, " + annotation.runId + ")'></td>";
		} else {
			//the annotation does not exist so we will leave the text area blank
			gradeByStepHtml += "<td><textarea rows='10' cols='10' id='annotationTextArea" + vleState.dataId + "'></textarea></td>";

			//add the save annotation button that will save the annotation to the db when clicked
			gradeByStepHtml += "<td><input type='button' name='submitAnnotation" + vleState.dataId + "' value='Save Annotation' onClick='saveAnnotation(\"" + nodeId + "\", " + vleState.dataId + ", " + teacherId + ", \"comment\", document.getElementById(\"annotationTextArea" + vleState.dataId + "\").value, " + runId + ")'></td>";
		}

		//get the flag (if any) that corresponds to the row we are displaying
		var flag = flags.getFlag(runId, nodeId, vleState.dataId, teacherId);
		var checked = "";
		
		if(flag != null) {
			//if there was a flag then we will set the checkbox to checked
			checked = "checked";
		}

		//display the checkbox for the flagging
		//gradeByStepHtml += "<td><input type='checkbox' name='flagCheckBox" + vleState.dataId + "' id='flagCheckBox" + vleState.dataId + "' onClick='saveFlag(\"" + nodeId + "\", " + vleState.dataId + ", " + teacherId + ", document.getElementById(\"flagCheckBox" + vleState.dataId + "\").checked, \"" + studentWork + "\", " + runId + ")' + " + checked + "></td>";
		gradeByStepHtml += "<td><input type='button' value='Flag Work' name='flagButton" + vleState.dataId + "' id='flagButton" + vleState.dataId + "' onClick='saveFlag(\"" + nodeId + "\", " + vleState.dataId + ", " + teacherId + ", \"" + studentWork + "\", " + runId + ", false)'></td>";
		
		gradeByStepHtml += "</tr>";
	}

	gradeByStepHtml += "</table>";

	//set the html in the div so the user can see it
	document.getElementById('gradeByStepDiv').innerHTML = gradeByStepHtml;
}

/**
 * Adds the flagged item to the flaggedItemsTable at the top of the page.
 * @param nodeId the id of the node
 * @param dataId the id of the student
 * @param teacherId the id of the teacher
 * @param studentWork what the student wrote
 * @param runId the id of the run
 * @param itemNumber the number of the item in the flaggedItemsTable
 */
function addFlaggedItemToDisplay(nodeId, dataId, teacherId, studentWork, runId, itemNumber) {
	//obtain the flaggedItemsTable
	var flaggedItemTable = document.getElementById('flaggedItemsTable');

	/*
	 * try to obtain the row that displays the message that there are no 
	 * flagged responses. this will not exist if there are flagged responses
	 * for this step.
	 */
	var noFlaggedResponsesRow = document.getElementById('noFlaggedResponses');

	if(noFlaggedResponsesRow != null) {
		/* 
		 * remove the row. flaggedItemTable.childNodes[0] is the tbody which
		 * contains the tr elements.
		 */
		flaggedItemTable.childNodes[0].removeChild(noFlaggedResponsesRow);
	}

	//obtain the number of the element we will add which we will use in the id
	if(itemNumber == null) {
		itemNumber = flaggedItemTable.childNodes[0].childNodes.length;
	}

	//create the row to display the flagged item
	var flagRow = document.createElement("tr");

	//set the id for the row
	flagRow.id = "flaggedItem" + itemNumber;

	//create the data that displays the student's work
	var flagDataWork = document.createElement("td");
	flagDataWork.innerHTML = studentWork;

	//create the data that displays the button to unflag the work
	var flagDataButton = document.createElement("td");
	flagDataButton.innerHTML = "<input type='button' value='Unflag Work' onClick='saveFlag(\"" + nodeId + "\", " + dataId + ", " + teacherId + ", \"" + studentWork + "\", " + runId + ", true," + itemNumber + ")'></input>"; 

	//add the data to the row
	flagRow.appendChild(flagDataWork);
	flagRow.appendChild(flagDataButton);

	/* 
	 * add the row to the table. flaggedItemTable.childNodes[0] is the tbody which
	 * contains the tr elements.
	 */
	flaggedItemTable.childNodes[0].appendChild(flagRow);
}

/**
 * Remove the flagged item from the flaggedItemsTable
 */
function removeFlaggedItemFromDisplay(itemNumber) {
	//get the flaggedItemsTable
	var flaggedItemTable = document.getElementById('flaggedItemsTable');

	//get the flagged item
	var flaggedItemToRemove = document.getElementById('flaggedItem' + itemNumber);

	/*
	 * remove the flagged item from the table. flaggedItemTable.childNodes[0] 
	 * is the tbody which contains the tr elements.
	 */
	flaggedItemTable.childNodes[0].removeChild(flaggedItemToRemove);

	//check if there are no more flagged items for this step
	if(flaggedItemsTableEmpty()) {
		//display the message that says there are no flagged responses
		addNoFlaggedResponsesMsg();
	}
}

/**
 * Display the "No flagged responses" message to the flaggedItemsTable
 */
function addNoFlaggedResponsesMsg() {
	//get the flaggedItemsTable
	var flaggedItemTable = document.getElementById('flaggedItemsTable');

	//create the row to display the message
	var noFlaggedResponsesRow = document.createElement("tr");

	//set the id
	noFlaggedResponsesRow.id = 'noFlaggedResponses';

	//set the text in the row
	noFlaggedResponsesRow.innerHTML = "<td>No flagged responses</td>";

	//add the row to the table if the table is empty
	if(flaggedItemsTableEmpty()) {
		/*
		 * add the message to the table. flaggedItemTable.childNodes[0] 
		 * is the tbody which contains the tr elements.
		 */
		flaggedItemTable.childNodes[0].appendChild(noFlaggedResponsesRow);
	}
}

/**
 * Remove the "No flagged responses" message from the flaggedItemsTable
 */
function removeNoFlaggedResponsesMsg() {
	//get the flaggedItemsTable
	var flaggedItemTable = document.getElementById('flaggedItemsTable');

	//get the row that displays the message
	var noFlaggedResponsesRow = document.getElementById('noFlaggedResponses');

	//check if the row exists
	if(noFlaggedResponsesRow != null) {
		/*
		 * remove the message from the table. flaggedItemTable.childNodes[0] 
		 * is the tbody which contains the tr elements.
		 */
		flaggedItemTable.childNodes[0].removeChild(noFlaggedResponsesRow);
	}
}

/**
 * Check if the flaggedItemsTable contains any flagged items
 */
function flaggedItemsTableEmpty() {
	var flaggedItemTable = document.getElementById('flaggedItemsTable');
	
	//check how many items are in the table
	if(flaggedItemTable.childNodes[0].childNodes.length == 1) {
		
		var noFlaggedResponsesRow = document.getElementById('noFlaggedResponses');
		
		/*
		 * check if the one item in the table is the "no flagged responses"
		 * row
		 */
		if(noFlaggedResponsesRow != null) {
			/*
			 * the one item is the "no flagged responses" row so the table has
			 * no flagged items and is empty
			 */
			return true;
		} else {
			/*
			 * the one item is not the "no flagged responses" row and is a
			 * flagged item, so the table is not empty
			 */
			return false;
		}
	} else {
		//there is more than one item so the table is not empty
		return false;
	}
}

/**
 * Obtain the latest student work by calling render again to retrieve the
 * latest data.
 */
function refresh() {
	render(this.contentURL, this.userURL, this.getDataUrl, this.contentBaseUrl, this.getAnnotationsUrl, this.postAnnotationsUrl, this.runId, this.getFlagsUrl, this.postFlagsUrl);
}
var myMenu;


</script>
<div id="soundmanager-debug"></div>
</body>
</html>